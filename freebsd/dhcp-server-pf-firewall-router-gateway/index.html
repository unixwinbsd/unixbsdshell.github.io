<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Installing FreeBSD DHCP Server with PF Filter Firewall for Firewall Gateway Router - UnixBSDShell</title>
<meta name="description" content="DHCP (Dynamic Host Configuration Protocol) provides automatic and static networks on client computers to obtain the configuration parameters needed to communicate with other systems in an IP (Internet Protocol)-based network. Parameters that are usually provided by a DHCP server include the assignment of IP addresses, DNS server addresses, and router addresses or default gateways.">


  <meta name="author" content="UnixBSDShell's Blog">
  
  <meta property="article:author" content="UnixBSDShell's Blog">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="UnixBSDShell">
<meta property="og:title" content="Installing FreeBSD DHCP Server with PF Filter Firewall for Firewall Gateway Router">
<meta property="og:url" content="https://unixwinbsd.site/freebsd/dhcp-server-pf-firewall-router-gateway/">


  <meta property="og:description" content="DHCP (Dynamic Host Configuration Protocol) provides automatic and static networks on client computers to obtain the configuration parameters needed to communicate with other systems in an IP (Internet Protocol)-based network. Parameters that are usually provided by a DHCP server include the assignment of IP addresses, DNS server addresses, and router addresses or default gateways.">





  <meta name="twitter:site" content="@iwanset96143401">
  <meta name="twitter:title" content="Installing FreeBSD DHCP Server with PF Filter Firewall for Firewall Gateway Router">
  <meta name="twitter:description" content="DHCP (Dynamic Host Configuration Protocol) provides automatic and static networks on client computers to obtain the configuration parameters needed to communicate with other systems in an IP (Internet Protocol)-based network. Parameters that are usually provided by a DHCP server include the assignment of IP addresses, DNS server addresses, and router addresses or default gateways.">
  <meta name="twitter:url" content="https://unixwinbsd.site/freebsd/dhcp-server-pf-firewall-router-gateway/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2025-06-07T09:01:05+03:00">





  

  


<link rel="canonical" href="https://unixwinbsd.site/freebsd/dhcp-server-pf-firewall-router-gateway/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "UnixBSDShell Blog",
      "url": "https://unixwinbsd.site/"
    
  }
</script>


  <meta name="google-site-verification" content="googledc9be5e5382da4fd" />


  <meta name="msvalidate.01" content="BCDF1444D895EBA62C6422C90DF8EA1C">



  <meta name="yandex-verification" content="69d778baa1dbd371">


<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="UnixBSDShell Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- <script data-ad-client="ca-pub-8799681346916578" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->

<!-- end custom head snippets -->


<meta name="google-site-verification" content="RT2u0cL3NCPK3ydcuewM50F8hvklo6JxBJGxu0zypiw" />
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js', 'ym');

    ym(95812963, 'init', {webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/95812963" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-TNPXBWRM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GT-TNPXBWRM');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWLWYNFRW0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RWLWYNFRW0');
</script>

<script>
gtag('set', 'user_data', {
"email": datainchi@gmail.com,
"phone_number": +6281289065249,
"address": {
"first_name": Iwan,
"last_name": Setiawan,
"street": Kp. Warung Bongkok RT. 002/01,
"city": Kabupaten Bekasi,
"region": Jawa Barat,
"postal_code": 17841,
"country": Indonesia
}
});
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N7TLZSRG');</script>
<!-- End Google Tag Manager -->



  </head>

  <body class="layout--single">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N7TLZSRG"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          UnixBSDShell
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Posts by Category</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Posts by Year</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://unixwinbsd.site/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#freebsd" itemprop="item"><span itemprop="name">Freebsd</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Installing FreeBSD DHCP Server with PF Filter Firewall for Firewall Gateway Router</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/pscustomobject.jpg" alt="UnixBSDShell's Blog" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">UnixBSDShell's Blog</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>unixwinbsd.site is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, unixwinbsd.site also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&amp;A forum for users to ask questions and get help from other members.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Moscow, Russia</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">DevOps Notes</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/iwan-setiawan-943659164/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:iwanse1212@yandex.com">
            <meta itemprop="email" content="iwanse1212@yandex.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Installing FreeBSD DHCP Server with PF Filter Firewall for Firewall Gateway Router">
    <meta itemprop="description" content="DHCP (Dynamic Host Configuration Protocol) provides automatic and static networks on client computers to obtain the configuration parameters needed to communicate with other systems in an IP (Internet Protocol)-based network. Parameters that are usually provided by a DHCP server include the assignment of IP addresses, DNS server addresses, and router addresses or default gateways.">
    <meta itemprop="datePublished" content="2025-06-07T09:01:05+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Installing FreeBSD DHCP Server with PF Filter Firewall for Firewall Gateway Router
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#1-system-specifications">1. System Specifications:</a></li>
  <li><a href="#2-isc-dhcp-server-installation">2. ISC-DHCP Server Installation</a></li>
  <li><a href="#3-isc-dhcp-server-configuration">3. ISC-DHCP Server Configuration</a></li>
  <li><a href="#4-packet-file-pf-firewall-configuration">4. Packet File (PF) Firewall configuration</a></li>
</ul>

            </nav>
          </aside>
        
        <p>DHCP (Dynamic Host Configuration Protocol) provides automatic and static networks on client computers to obtain the configuration parameters needed to communicate with other systems in an IP (Internet Protocol)-based network. Parameters that are usually provided by a DHCP server include the assignment of IP addresses, DNS server addresses, and router addresses or default gateways.</p>

<p>When a client computer first connects to the internet using a DHCP Server, the DHCP server immediately broadcasts a request to the local network for configuration information. The DHCP Server then answers this request with the parameters specified in the DHCP server configuration. The client computer directly applies the configuration specified by the DHCP Server to the network interface to communicate with other networks in one IP Address subnet.</p>

<p>DHCP servers generally assign IP addresses in one of two ways, static or dynamic. The static method allocates IP addresses to clients based on the client’s hardware MAC address. This IP address will remain unchanged. Meanwhile, dynamic IP addresses are rented addresses, there is a time when the lease expires. The DHCP server assigns IP addresses from a pool or range defined by the administrator. The dynamic IP will be returned to the pool when the client disconnects from the network. If the same client rejoins the network, it may be assigned a different IP address if the previously assigned address is not available.</p>

<p>DHCP first appeared in October 1993 as a replacement for BOOTP (Bootstrap Protocol). Version 1 of the ISC-DHCP server was released by Ted Lemon in December 1997. The ISC-DHCP implementation remains one of the most popular and powerful open source DHCP solutions.</p>

<p><img src="https://gitflic.ru/project/unixbsdshell/ruby-static-page-jekyll-rb-openbsd/blob/raw?file=assets%2Fimages%2F25freebsd%20dhcp%20server.jpg&amp;commit=68a9483f87b246f236bede2dd9a7a3a9418ac94c" alt="freebsd dhcp server router gateway" /></p>

<p><br /></p>

<h2 id="1-system-specifications">1. System Specifications:</h2>

<ul>
  <li>OS: FreeBSD 13.2 Stable</li>
  <li>CPU: AMD Phenom(tm) II X4 955 Processor</li>
  <li>IP Land Card (on board) nfe0: 192.168.5.2 (WAN)</li>
  <li>IP Land Card vr0: 192.168.7.1 (For LAN, private network)</li>
  <li>Hostname: ns1</li>
  <li>Domain: unixexplore.com</li>
  <li>Versi DHCP Server: isc-dhcp44-server-4.4.3P1</li>
</ul>

<h2 id="2-isc-dhcp-server-installation">2. ISC-DHCP Server Installation</h2>

<p>On FreeBSD systems ISC DHCP Server can be installed via the Ports system or with the pkg package. In this article we will explain how to install the ISC DHCP Server using the pkg package. The first thing you have to do is update the pkg package.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>pkg update <span class="nt">-f</span>
<span class="gp">root@ns1:~ #</span><span class="w"> </span>pkg upgrade <span class="nt">-f</span>
</code></pre></div></div>
<p>The update function above is to get the latest version of the DHCP Server application. After that, type the command below to install the DHCP Server.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>pkg <span class="nb">install </span>isc-dhcp44-client
<span class="gp">root@ns1:~ #</span><span class="w"> </span>pkg <span class="nb">install </span>isc-dhcp44-relay
<span class="gp">root@ns1:~ #</span><span class="w"> </span>pkg delete isc-dhcp44-server
<span class="go">Checking integrity... done (0 conflicting)
Deinstallation has been requested for the following 1 packages (of 0 packages in the universe):

Installed packages to be REMOVED:
	isc-dhcp44-server: 4.4.3P1

</span><span class="gp">==&gt;</span><span class="w"> </span>You should manually remove the <span class="s2">"dhcpd"</span> user. 
<span class="gp">==&gt;</span><span class="w"> </span>You should manually remove the <span class="s2">"dhcpd"</span> group 
<span class="go">You may need to manually remove /usr/local/etc/dhcpd.conf if it is no longer needed.
</span><span class="gp">root@ns1:~ #</span><span class="w"> </span>pkg <span class="nb">install </span>isc-dhcp44-server
<span class="go">Updating FreeBSD repository catalogue...
FreeBSD repository is up to date.
All repositories are up to date.
Checking integrity... done (0 conflicting)
The following 1 package(s) will be affected (of 0 checked):

New packages to be INSTALLED:
	isc-dhcp44-server: 4.4.3P1

Number of packages to be installed: 1

The process will require 7 MiB more space.

Proceed with this action? [y/N]: y
[1/1] Installing isc-dhcp44-server-4.4.3P1...
</span><span class="gp">===&gt;</span><span class="w"> </span>Creating groups.
<span class="go">Using existing group 'dhcpd'.
</span><span class="gp">===&gt;</span><span class="w"> </span>Creating <span class="nb">users</span>
<span class="go">Using existing user 'dhcpd'.
[1/1] Extracting isc-dhcp44-server-4.4.3P1: 100%
=====
Message from isc-dhcp44-server-4.4.3P1:

--
****  To setup dhcpd, please edit /usr/local/etc/dhcpd.conf.

****  This port installs the dhcp daemon, but doesn't invoke dhcpd by default.
      If you want to invoke dhcpd at startup, add these lines to /etc/rc.conf:

</span><span class="gp">	    dhcpd_enable="YES"				#</span><span class="w"> </span>dhcpd enabled?
<span class="gp">	    dhcpd_flags="-q"				#</span><span class="w"> </span><span class="nb">command </span>option<span class="o">(</span>s<span class="o">)</span>
<span class="gp">	    dhcpd_conf="/usr/local/etc/dhcpd.conf"	#</span><span class="w"> </span>configuration file
<span class="gp">	    dhcpd_ifaces=""				#</span><span class="w"> </span>ethernet interface<span class="o">(</span>s<span class="o">)</span>
<span class="gp">	    dhcpd_withumask="022"			#</span><span class="w"> </span>file creation mask
<span class="go">
****  If compiled with paranoia support (the default), the following rc.conf
      options are also supported:

</span><span class="gp">	    dhcpd_chuser_enable="YES"		#</span><span class="w"> </span>runs w/o privileges?
<span class="gp">	    dhcpd_withuser="dhcpd"		#</span><span class="w"> </span>user name to run as
<span class="gp">	    dhcpd_withgroup="dhcpd"		#</span><span class="w"> </span>group name to run as
<span class="gp">	    dhcpd_chroot_enable="YES"		#</span><span class="w"> </span>runs chrooted?
<span class="gp">	    dhcpd_devfs_enable="YES"		#</span><span class="w"> </span>use devfs <span class="k">if </span>available?
<span class="gp">	    dhcpd_rootdir="/var/db/dhcpd"	#</span><span class="w"> </span>directory to run <span class="k">in</span>
<span class="gp">	    dhcpd_includedir="&lt;some_dir&gt;</span><span class="s2">"	# directory with config-
</span><span class="go">						  files to include

****  WARNING: never edit the chrooted or jailed dhcpd.conf file but
      /usr/local/etc/dhcpd.conf instead which is always copied where
      needed upon startup.
</span></code></pre></div></div>
<p>When you have finished installing the DHCP Server, an article will appear containing recommendations for configuring the DHCP Server. We will use these recommendations as a benchmark for configuring the DHCP server.</p>

<h2 id="3-isc-dhcp-server-configuration">3. ISC-DHCP Server Configuration</h2>

<p>Once the installation is complete, continue with configuring the DHCP Server. The first step that must be taken is to create an rc.d script, so that the DHCP server can be booted automatically when the computer is restarted/rebooted. Add the script below to the <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> file.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /etc/rc.conf
<span class="go">hostname="ns1"
ifconfig_nfe0="inet 192.168.5.2 netmask 255.255.255.0"
ifconfig_vr0="inet 192.168.7.1 netmask 255.255.255.0"
defaultrouter="192.168.5.1"
gateway_enable="YES"

dhcpd_enable="YES"
</span><span class="gp">#</span><span class="nv">dhcpd_flags</span><span class="o">=</span><span class="s2">"-q -early_chroot"</span>
<span class="go">dhcpd_conf="/usr/local/etc/dhcpd.conf"
</span><span class="gp">#</span><span class="nv">dhcpd_ifaces</span><span class="o">=</span><span class="s2">"rl0"</span>
<span class="go">dhcpd_withumask="022"
</span><span class="gp">#</span><span class="nv">dhcpd_chuser_enable</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="go">dhcpd_withuser="dhcpd"
dhcpd_withgroup="dhcpd"
</span><span class="gp">#</span><span class="nv">dhcpd_chroot_enable</span><span class="o">=</span><span class="s2">"YES"</span>
<span class="go">dhcpd_devfs_enable="YES"
dhcpd_rootdir="/var/db/dhcpd"
</span></code></pre></div></div>
<p>The main configuration file is <code class="language-plaintext highlighter-rouge">dhcpd.conf</code>, from the script above it is clear that the file is located at <code class="language-plaintext highlighter-rouge">/usr/local/etc/dhcpd.conf</code>. Edit the <code class="language-plaintext highlighter-rouge">/usr/local/etc/dhcpd.conf</code> file, as in the example below.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /usr/local/etc/dhcpd.conf
<span class="gp">#</span><span class="w"> </span>dhcpd.conf
<span class="gp">#</span><span class="w">
</span><span class="gp">#</span><span class="w"> </span>Sample configuration file <span class="k">for </span>ISC dhcpd
<span class="gp">#</span><span class="w">
</span><span class="go">
</span><span class="gp">#</span><span class="w"> </span>option definitions common to all supported networks...
<span class="gp">option domain-name "unixexplore.com";</span><span class="w">
</span><span class="gp">option domain-name-servers 1.1.1.1, 1.0.0.1, 8.8.8.8;</span><span class="w">
</span><span class="gp">option domain-search-list code 119 = text;</span><span class="w">
</span><span class="gp">option arch code 93 = unsigned integer 16;</span><span class="w">
</span><span class="gp">option ldap-server code 95 = text;</span><span class="w">
</span><span class="go">
</span><span class="gp">default-lease-time 600;</span><span class="w">
</span><span class="gp">max-lease-time 7200;</span><span class="w">
</span><span class="go">
</span><span class="gp">#</span><span class="w"> </span>Use this to enble / disable dynamic dns updates globally.
<span class="gp">#</span>ddns-update-style none<span class="p">;</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>If this DHCP server is the official DHCP server <span class="k">for </span>the <span class="nb">local</span>
<span class="gp">#</span><span class="w"> </span>network, the authoritative directive should be uncommented.
<span class="gp">authoritative;</span><span class="w">
</span><span class="gp">one-lease-per-client true;</span><span class="w">
</span><span class="gp">deny duplicates;</span><span class="w">
</span><span class="gp">update-conflict-detection false;</span><span class="w">
</span><span class="go">
</span><span class="gp">#</span><span class="w"> </span>Use this to send dhcp log messages to a different log file <span class="o">(</span>you also
<span class="gp">#</span><span class="w"> </span>have to hack syslog.conf to <span class="nb">complete </span>the redirection<span class="o">)</span><span class="nb">.</span>
<span class="gp">log-facility local7;</span><span class="w">
</span><span class="go">
</span><span class="gp">#</span><span class="w"> </span>No service will be given on this subnet, but declaring it helps the 
<span class="gp">#</span><span class="w"> </span>DHCP server to understand the network topology.
<span class="go">
subnet 192.168.5.0 netmask 255.255.255.0 {
}

</span><span class="gp">#</span><span class="w"> </span>This is a very basic subnet declaration.
<span class="go">
subnet 192.168.7.0 netmask 255.255.255.0 {
</span><span class="gp">        range 192.168.7.2 192.168.7.250;</span><span class="w">
</span><span class="gp">        option routers 192.168.7.1;</span><span class="w">
</span><span class="gp">		option broadcast-address 192.168.7.255;</span><span class="w">
</span><span class="gp">		option domain-name "unixexplore.com";</span><span class="w">
</span><span class="gp">		option domain-search "ns1.unixexplore.com";</span><span class="w">
</span><span class="gp">        option domain-name-servers 1.1.1.1, 1.0.0.1, 9.9.9.9;</span><span class="w">
</span><span class="go">}

</span><span class="gp">#</span><span class="w"> </span>This declaration allows BOOTP clients to get dynamic addresses,
<span class="gp">#</span><span class="w"> </span>which we don<span class="s1">'t really recommend.
</span><span class="go">
</span><span class="gp">#</span>subnet 10.254.239.32 netmask 255.255.255.224 <span class="o">{</span>
<span class="gp">#</span><span class="w">  </span>range dynamic-bootp 10.254.239.40 10.254.239.60<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>option broadcast-address 10.254.239.31<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>option routers rtr-239-32-1.example.org<span class="p">;</span>
<span class="gp">#</span><span class="o">}</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>A slightly different configuration <span class="k">for </span>an internal subnet.
<span class="gp">#</span>subnet 10.5.5.0 netmask 255.255.255.224 <span class="o">{</span>
<span class="gp">#</span><span class="w">  </span>range 10.5.5.26 10.5.5.30<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>option domain-name-servers ns1.internal.example.org<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>option domain-name <span class="s2">"internal.example.org"</span><span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>option routers 10.5.5.1<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>option broadcast-address 10.5.5.31<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>default-lease-time 600<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>max-lease-time 7200<span class="p">;</span>
<span class="gp">#</span><span class="o">}</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Hosts which require special configuration options can be listed <span class="k">in</span>
<span class="gp">#</span><span class="w"> </span>host statements.   If no address is specified, the address will be
<span class="gp">#</span><span class="w"> </span>allocated dynamically <span class="o">(</span><span class="k">if </span>possible<span class="o">)</span>, but the host-specific information
<span class="gp">#</span><span class="w"> </span>will still come from the host declaration.
<span class="go">
</span><span class="gp">#</span>host passacaglia <span class="o">{</span>
<span class="gp">#</span><span class="w">  </span>hardware ethernet 0:0:c0:5d:bd:95<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>filename <span class="s2">"vmunix.passacaglia"</span><span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>server-name <span class="s2">"toccata.example.com"</span><span class="p">;</span>
<span class="gp">#</span><span class="o">}</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Fixed IP addresses can also be specified <span class="k">for </span>hosts.   These addresses
<span class="gp">#</span><span class="w"> </span>should not also be listed as being available <span class="k">for </span>dynamic assignment.
<span class="gp">#</span><span class="w"> </span>Hosts <span class="k">for </span>which fixed IP addresses have been specified can boot using
<span class="gp">#</span><span class="w"> </span>BOOTP or DHCP.   Hosts <span class="k">for </span>which no fixed address is specified can only
<span class="gp">#</span><span class="w"> </span>be booted with DHCP, unless there is an address range on the subnet
<span class="gp">#</span><span class="w"> </span>to which a BOOTP client is connected which has the dynamic-bootp flag
<span class="gp">#</span><span class="w"> </span>set.
<span class="gp">#</span>host fantasia <span class="o">{</span>
<span class="gp">#</span><span class="w">  </span>hardware ethernet 08:00:07:26:c0:a5<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span>fixed-address fantasia.example.com<span class="p">;</span>
<span class="gp">#</span><span class="o">}</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>You can <span class="nb">declare </span>a class of clients and <span class="k">then do </span>address allocation
<span class="gp">#</span><span class="w"> </span>based on that.   The example below shows a <span class="k">case</span> where all clients
<span class="gp">#</span><span class="w"> </span><span class="k">in </span>a certain class get addresses on the 10.17.224/24 subnet, and all
<span class="gp">#</span><span class="w"> </span>other clients get addresses on the 10.0.29/24 subnet.
<span class="go">
</span><span class="gp">#</span>class <span class="s2">"foo"</span> <span class="o">{</span>
<span class="gp">#</span><span class="w">  </span>match <span class="k">if </span>substring <span class="o">(</span>option vendor-class-identifier, 0, 4<span class="o">)</span> <span class="o">=</span> <span class="s2">"SUNW"</span><span class="p">;</span>
<span class="gp">#</span><span class="o">}</span>
<span class="go">
</span><span class="gp">#</span>shared-network 224-29 <span class="o">{</span>
<span class="gp">#</span><span class="w">  </span>subnet 10.17.224.0 netmask 255.255.255.0 <span class="o">{</span>
<span class="gp">#</span><span class="w">    </span>option routers rtr-224.example.org<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span><span class="o">}</span>
<span class="gp">#</span><span class="w">  </span>subnet 10.0.29.0 netmask 255.255.255.0 <span class="o">{</span>
<span class="gp">#</span><span class="w">    </span>option routers rtr-29.example.org<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span><span class="o">}</span>
<span class="gp">#</span><span class="w">  </span>pool <span class="o">{</span>
<span class="gp">#</span><span class="w">    </span>allow members of <span class="s2">"foo"</span><span class="p">;</span>
<span class="gp">#</span><span class="w">    </span>range 10.17.224.10 10.17.224.250<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span><span class="o">}</span>
<span class="gp">#</span><span class="w">  </span>pool <span class="o">{</span>
<span class="gp">#</span><span class="w">    </span>deny members of <span class="s2">"foo"</span><span class="p">;</span>
<span class="gp">#</span><span class="w">    </span>range 10.0.29.10 10.0.29.230<span class="p">;</span>
<span class="gp">#</span><span class="w">  </span><span class="o">}</span>
<span class="gp">#</span><span class="o">}</span>
</code></pre></div></div>
<p>What you need to pay attention to when editing the dhcpd.conf file is the IP address for the LAN or local/private network. In the dhcpd.conf script above the IP for the LAN is in the subnet <code class="language-plaintext highlighter-rouge">192.168.7.0</code> netmask <code class="language-plaintext highlighter-rouge">255.255.255.0</code> with the range <code class="language-plaintext highlighter-rouge">192.168.7.2 192.168.7.250</code>. When the dhcpd.conf file configuration has been completed, it is time to test the DHCP server, whether it is RUNNING or not.</p>

<p>Next, create a log file, this file is useful for controlling DHCP server activity. With a log file, monitoring can be done at any time and when needed. Enter the following script in the <code class="language-plaintext highlighter-rouge">/etc/syslog.conf</code> and <code class="language-plaintext highlighter-rouge">/etc/newsyslog.conf</code> files.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /etc/syslog.conf
<span class="go">local7.*					/var/log/dhcpd.log
</span><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /etc/newsyslog.conf
<span class="go">/var/log/dhcpd.log                      600  7     *    @T00  JC
</span></code></pre></div></div>
<p>Create a log file in the <code class="language-plaintext highlighter-rouge">/var/log</code> folder.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span><span class="nb">touch</span> /var/log/dhcpd.log
</code></pre></div></div>
<p>If a log file has been created, provide file ownership rights and permissions.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span><span class="nb">chown</span> <span class="nt">-R</span> dhcpd:dhcpd /var/db/dhcpd/
<span class="gp">root@ns1:~ #</span><span class="w"> </span><span class="nb">chown</span> <span class="nt">-R</span> dhcpd:dhcpd /var/log/dhcpd.log
</code></pre></div></div>

<h2 id="4-packet-file-pf-firewall-configuration">4. Packet File (PF) Firewall configuration</h2>

<p>If you haven’t missed any steps to configure the ISC-DHCP Server, continue by configuring the Firewall Packet Filter. This firewall is used to regulate incoming and outgoing traffic, which ones must pass through and which ones must be blocked. Before creating Packet Filter rules, first activate the PF Firewall kernel module. In the file <code class="language-plaintext highlighter-rouge">/usr/src/sys/amd64/conf/GENERIC</code>, type the following script and place it at the bottom of the <code class="language-plaintext highlighter-rouge">GENERIC</code> file.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /usr/src/sys/amd64/conf/GENERIC
<span class="go">options         ALTQ
options         ALTQ_CBQ
options         ALTQ_RED
options         ALTQ_RIO
options         ALTQ_HFSC
options         ALTQ_PRIQ
device	    pf
device	    pflog
device	    pfsync
</span></code></pre></div></div>
<p>Build and install the file <code class="language-plaintext highlighter-rouge">/usr/src/sys/amd64/conf/GENERIC</code> which has been included in the kernel Packet Filter module.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span><span class="nb">cd</span> /usr/src
<span class="gp">root@ns1:/usr/src #</span><span class="w"> </span>make buildkernel <span class="nv">KERNCONF</span><span class="o">=</span>GENERIC
<span class="gp">root@ns1:/usr/src #</span><span class="w"> </span>make installkernel <span class="nv">KERNCONF</span><span class="o">=</span>GENERIC
</code></pre></div></div>
<p>The process is a bit long, wait until the build and install <code class="language-plaintext highlighter-rouge">GENERIC</code> kernel process is complete. After that, continue by creating Packet Filter Firewall rules. In the <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> file, add the following script to automatically boot PF Firewall.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /etc/rc.conf
<span class="gp">pf_enable="YES" #</span><span class="w"> </span>Enable PF <span class="o">(</span>load module <span class="k">if </span>required<span class="o">)</span>
<span class="go">pf_rules="/etc/pf.conf"
</span><span class="gp">pf_flags="" #</span><span class="w"> </span>additional flags <span class="k">for </span>pfctl startup
<span class="gp">pflog_enable="YES" #</span><span class="w"> </span>start pflogd<span class="o">(</span>8<span class="o">)</span>
<span class="gp">pflog_logfile="/var/log/pflog" #</span><span class="w"> </span>where pflogd should store the logfile
<span class="gp">pflog_flags="" #</span><span class="w"> </span>additional flags <span class="k">for </span>pflogd startup
<span class="go">pflogd_enable="YES"
pfsync_enable="YES"
</span></code></pre></div></div>
<p>Create a file <code class="language-plaintext highlighter-rouge">/etc/pf.conf</code> and enter the script below.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span><span class="nb">touch</span> /etc/pf.conf
<span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /etc/pf.conf
<span class="go">set limit table-entries 400000
set optimization normal
set limit states 198000
set limit src-nodes 198000

</span><span class="gp">#</span>System aliases
<span class="go">loopback = "{ lo0 }"
WANINDIHOME = "{ nfe0 }"
LANWIFI = "{ vr0 }"

</span><span class="gp">#</span>table &lt;bogons&gt; persist file <span class="s2">"/etc/bogons"</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Gateways
<span class="go">GWWANINDIHOMEGW = " route-to ( nfe0 192.168.5.1 ) "
GWLANWIFIGW = " route-to ( vr0 192.168.7.1 ) "

set block-policy return
set loginterface vr0
set keepcounters
set skip on pfsync0
set skip on lo0
</span><span class="gp">set skip on $</span>LANWIFI
<span class="go">
</span><span class="gp">scrub on $</span>WANINDIHOME inet all fragment reassemble
<span class="gp">scrub on $</span>LANWIFI inet all fragment reassemble
<span class="go">
</span><span class="gp">#</span>no nat proto carp
<span class="gp">#</span>no rdr proto carp
<span class="gp">#</span>nat-anchor <span class="s2">"natearly/*"</span>
<span class="gp">#</span>nat-anchor <span class="s2">"natrules/*"</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Outbound NAT rules <span class="o">(</span>manual<span class="o">)</span>
<span class="gp">nat on $</span>WANINDIHOME inet from 127.0.0.0/8 to any port 500 -&gt; 192.168.5.2/32 static-port <span class="c"># Auto created rule for ISAKMP - localhost to WAN</span>
<span class="gp">nat on $</span>WANINDIHOME inet from 127.0.0.0/8 to any -&gt; 192.168.5.2/32 port 1024:65535 <span class="c"># Auto created rule - localhost to WAN</span>
<span class="gp">nat on $</span>WANINDIHOME inet from 192.168.7.0/24 to any port 500 -&gt; 192.168.5.2/32 static-port <span class="c"># Auto created rule for ISAKMP - localhost to LAN</span>
<span class="gp">nat on $</span>WANINDIHOME inet from 192.168.7.0/24 to any -&gt; 192.168.5.2/32 port 1024:65535 <span class="c"># Auto created rule - localhost to LAN</span>
<span class="gp">nat on $</span>WANINDIHOME inet from 192.168.5.0/24 to any port 500 -&gt; 192.168.5.2/32 static-port <span class="c"># Auto created rule for ISAKMP - localhost to LAN</span>
<span class="gp">nat on $</span>WANINDIHOME inet from 192.168.5.0/24 to any -&gt; 192.168.5.2/32 port 1024:65535 <span class="c"># Auto created rule - localhost to LAN</span>
<span class="go">
</span><span class="gp">#</span>Redirect this traffic to our internal servers
<span class="gp">rdr on $</span>LANWIFI proto tcp from any to any port 53 -&gt; 192.168.7.1 port 53
<span class="gp">rdr on $</span>LANWIFI proto udp from any to any port 53 -&gt; 192.168.7.1 port 53
<span class="gp">rdr on $</span>LANWIFI proto udp from any to any port 80 -&gt; 192.168.7.1 port 8002
<span class="go">
block in log quick from 169.254.0.0/16 to any ridentifier 1000000101 label "Block IPv4 link-local"
block in log quick from any to 169.254.0.0/16 ridentifier 1000000102 label "Block IPv4 link-local"
block in log inet all ridentifier 1000000103 label "Default deny rule IPv4"
block out log inet all ridentifier 1000000104 label "Default deny rule IPv4"
block log quick inet proto { tcp, udp } from any port = 0 to any ridentifier 1000000114 label "Block traffic from port 0"
block log quick inet proto { tcp, udp } from any to any port = 0 ridentifier 1000000115 label "Block traffic to port 0"
</span><span class="gp">block in log quick on $</span>WANINDIHOME from &lt;bogons&gt; to any ridentifier 11001 label <span class="s2">"block bogon IPv4 networks from WANINDIHOME"</span>
<span class="gp">block in log quick on $</span>WANINDIHOME from 10.0.0.0/8 to any ridentifier 12001 label <span class="s2">"Block private networks from WANINDIHOME block 10/8"</span>
<span class="gp">block in log quick on $</span>WANINDIHOME from 127.0.0.0/8 to any ridentifier 12002 label <span class="s2">"Block private networks from WANINDIHOME block 127/8"</span>
<span class="gp">block in log quick on $</span>WANINDIHOME from 172.16.0.0/12 to any ridentifier 12003 label <span class="s2">"Block private networks from WANINDIHOME block 172.16/12"</span>
<span class="gp">block in log quick on $</span>WANINDIHOME from 192.168.0.0/16 to any ridentifier 12004 label <span class="s2">"Block private networks from WANINDIHOME block 192.168/16"</span>
<span class="gp">block in log quick on $</span>WANINDIHOME from fc00::/7 to any ridentifier 12005 label <span class="s2">"Block ULA networks from WANINDIHOME block fc00::/7"</span>
<span class="go">
pass in all
pass out all
</span><span class="gp">antispoof log for $</span>WANINDIHOME ridentifier 1000001570
<span class="gp">antispoof log for $</span>LANWIFI ridentifier 1000002620
<span class="go">pass quick on lo0 all

</span><span class="gp">#</span>allow access to DHCP server on LANWIFI
<span class="gp">pass in quick on $</span>LANWIFI proto udp from any port <span class="o">=</span> 68 to 255.255.255.255 port <span class="o">=</span> 67 ridentifier 1000002641 label <span class="s2">"allow access to DHCP server"</span>
<span class="gp">pass in quick on $</span>LANWIFI proto udp from any port <span class="o">=</span> 68 to 192.168.7.1 port <span class="o">=</span> 67 ridentifier 1000002642 label <span class="s2">"allow access to DHCP server"</span>
<span class="gp">pass out quick on $</span>LANWIFI proto udp from 192.168.7.1 port <span class="o">=</span> 67 to any port <span class="o">=</span> 68 ridentifier 1000002643 label <span class="s2">"allow access to DHCP server"</span>
<span class="go">
</span><span class="gp">#</span>First rule - allow all traffic from this server
<span class="gp">pass in on $</span>loopback inet all ridentifier 1000002661 label <span class="s2">"pass IPv4 loopback"</span>
<span class="gp">pass out on $</span>loopback inet all ridentifier 1000002662 label <span class="s2">"pass IPv4 loopback"</span>
<span class="gp">pass in on $</span>loopback inet6 all ridentifier 1000002663 label <span class="s2">"pass IPv6 loopback"</span>
<span class="go">pass out inet all keep state allow-opts ridentifier 1000002665 label "let out anything IPv4 from firewall host itself"
pass out route-to ( nfe0 192.168.5.1 ) from 192.168.5.2 to !192.168.5.0/24 ridentifier 1000002761 keep state allow-opts label "let out anything from firewall host itself"
pass out route-to ( vr0 192.168.7.1 ) from 192.168.7.1 to !192.168.7.0/24 ridentifier 1000002762 keep state allow-opts label "let out anything from firewall host itself"

</span><span class="gp">#</span><span class="w"> </span><span class="c"># # INCOMING TRAFFIC # # #</span>
<span class="go">block in log all

</span><span class="gp">#</span><span class="w"> </span>NAT Reflection rules
<span class="go">pass in inet tagged PFREFLECT ridentifier 1000003081 keep state label "NAT REFLECT: Allow traffic to localhost"
</span><span class="gp">pass in quick on $</span>WANINDIHOME reply-to <span class="o">(</span> nfe0 192.168.5.1 <span class="o">)</span> inet from any to any ridentifier 1676950281 keep state label <span class="s2">"USER_RULE"</span>
<span class="go">
</span><span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet proto tcp from 192.168.7.0/24 to any port 22 ridentifier 1676946710 flags S/SA keep state label <span class="s2">"SSH"</span>
<span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet proto tcp from 192.168.7.0/24 to any port 53 ridentifier 1676946713 flags S/SA keep state label <span class="s2">"USER_RULE: Default allow LAN to any rule"</span>
<span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet proto udp from 192.168.7.0/24 to any port 53 ridentifier 1676946729 keep state label <span class="s2">"USER_RULE: Default allow LAN to any rule"</span>
<span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet proto tcp from 192.168.7.0/24 to any port 80 ridentifier 1676947088 flags S/SA keep state label <span class="s2">"USER_RULE: Default allow LAN to any rule"</span>
<span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet proto tcp from 192.168.7.0/24 to any port 443 ridentifier 1676947099 flags S/SA keep state label <span class="s2">"USER_RULE: Default allow LAN to any rule"</span>
<span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet proto tcp from 192.168.7.0/24 to any port 123 ridentifier 1676947120 flags S/SA keep state label <span class="s2">"USER_RULE: Default allow LAN to any rule"</span>
<span class="gp">pass in quick on $</span>LANWIFI reply-to <span class="o">(</span> vr0 192.168.7.1 <span class="o">)</span> inet from 192.168.7.0/24 to any ridentifier 0100000101 keep state label <span class="s2">"USER_RULE: Default allow LAN to any rule"</span>
</code></pre></div></div>

<p>After all applications have been configured and nothing has been missed, restart all the applications that we have configured.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>service isc-dhcpd restart
<span class="gp">root@ns1:~ #</span><span class="w"> </span>service syslogd restart
<span class="gp">root@ns1:~ #</span><span class="w"> </span>service pf restart
</code></pre></div></div>
<p>If you didn’t miss anything in the above configuration, at this point you should have a FreeBSD Router Gateway with PF Firewall. Now you can enable your Windows clients with Static IP or dynamic IP obtained from DHCP Server.</p>

<p>Even with the above configuration, your FreeBSD Router Gateway is up and running, but it seems incomplete if DNS server is not installed. Please choose the appropriate DNS server, BIND or Unbound, all are equally good according to your network system needs.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#dnsserver" class="page__taxonomy-item" rel="tag">DNSServer</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#freebsd" class="page__taxonomy-item" rel="tag">FreeBSD</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2025-06-07T09:01:05+03:00">June 7, 2025</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=iwanset96143401&text=Installing+FreeBSD+DHCP+Server+with+PF+Filter+Firewall+for+Firewall+Gateway+Router%20https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Fdhcp-server-pf-firewall-router-gateway%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Fdhcp-server-pf-firewall-router-gateway%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Fdhcp-server-pf-firewall-router-gateway%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/freebsd/isc-bind-dns-master-slave-configuration-freebsd/" class="pagination--pager" title="FreeBSD ISC Bind - Master and Slave DNS Configuration
">Previous</a>
    
    
      <a href="/freebsd/installation-configuration-tor-onion-freebsd/" class="pagination--pager" title="TOR Installation And Configuration On FreeBSD Server
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/installation-java-development-kit-on-freebsd/" rel="permalink">Installing and Using the Java Development Kit on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Redmine is open source software or application that uses the Ruby On Rails Framework. Redmine is a project management or project tracking application which r...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/how-to-install-webmin-on-freebsd-machine/" rel="permalink">How to Install Webmin on a FreeBSD System
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Webmin is a web-based system administration tool for Unix-like servers, and a service with approximately 1,000,000 annual installations worldwide
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/configuration-radicale-caldav-cardavv-server-freebsd/" rel="permalink">How to Configure FreeBSD with Radicale CalDAV CardDAV Server
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Radicale is run with the help of the Apache or NGINX web server, so it can be operated either as a standalone package using its internal http/https server or...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/setup-mirror-site-convert-pkg-package-freebsd/" rel="permalink">Setting up a Mirror Site to convert PKG Packages on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">PKG packages on FreeBSD contain pre-compiled software packages – called packages. This is the easiest way to install additional software under TwinCAT/BSD or...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/catanesi/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn Profile</a></li>
        
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 UnixBSDShell Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://unixwinbsd.site/freebsd/dhcp-server-pf-firewall-router-gateway/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/freebsd/dhcp-server-pf-firewall-router-gateway"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://UnixBSDShell.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  







  </body>
</html>
