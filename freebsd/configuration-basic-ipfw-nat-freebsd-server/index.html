<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Basic Configuration of IPFW NAT Firewall with FreeBSD Server - UnixBSDShell</title>
<meta name="description" content="IPFIREWALL (IPFW) is a FreeBSD-sponsored firewall software application written and maintained by volunteer FreeBSD staff members. IPFW uses legacy stateless rules and legacy rule coding techniques to achieve what is called Simple Stateful logic">


  <meta name="author" content="UnixBSDShell's Blog">
  
  <meta property="article:author" content="UnixBSDShell's Blog">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="UnixBSDShell">
<meta property="og:title" content="Basic Configuration of IPFW NAT Firewall with FreeBSD Server">
<meta property="og:url" content="https://unixwinbsd.site/freebsd/configuration-basic-ipfw-nat-freebsd-server/">


  <meta property="og:description" content="IPFIREWALL (IPFW) is a FreeBSD-sponsored firewall software application written and maintained by volunteer FreeBSD staff members. IPFW uses legacy stateless rules and legacy rule coding techniques to achieve what is called Simple Stateful logic">





  <meta name="twitter:site" content="@iwanset96143401">
  <meta name="twitter:title" content="Basic Configuration of IPFW NAT Firewall with FreeBSD Server">
  <meta name="twitter:description" content="IPFIREWALL (IPFW) is a FreeBSD-sponsored firewall software application written and maintained by volunteer FreeBSD staff members. IPFW uses legacy stateless rules and legacy rule coding techniques to achieve what is called Simple Stateful logic">
  <meta name="twitter:url" content="https://unixwinbsd.site/freebsd/configuration-basic-ipfw-nat-freebsd-server/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2025-07-13T04:52:21+03:00">





  

  


<link rel="canonical" href="https://unixwinbsd.site/freebsd/configuration-basic-ipfw-nat-freebsd-server/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "UnixBSDShell Blog",
      "url": "https://unixwinbsd.site/"
    
  }
</script>


  <meta name="google-site-verification" content="googledc9be5e5382da4fd" />


  <meta name="msvalidate.01" content="BCDF1444D895EBA62C6422C90DF8EA1C">



  <meta name="yandex-verification" content="69d778baa1dbd371">


<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="UnixBSDShell Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- <script data-ad-client="ca-pub-8799681346916578" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->

<!-- end custom head snippets -->


<meta name="google-site-verification" content="RT2u0cL3NCPK3ydcuewM50F8hvklo6JxBJGxu0zypiw" />
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js', 'ym');

    ym(95812963, 'init', {webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/95812963" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-TNPXBWRM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GT-TNPXBWRM');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWLWYNFRW0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RWLWYNFRW0');
</script>

<script>
gtag('set', 'user_data', {
"email": datainchi@gmail.com,
"phone_number": +6281289065249,
"address": {
"first_name": Iwan,
"last_name": Setiawan,
"street": Kp. Warung Bongkok RT. 002/01,
"city": Kabupaten Bekasi,
"region": Jawa Barat,
"postal_code": 17841,
"country": Indonesia
}
});
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N7TLZSRG');</script>
<!-- End Google Tag Manager -->



  </head>

  <body class="layout--single">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N7TLZSRG"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          UnixBSDShell
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Posts by Category</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Posts by Year</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://unixwinbsd.site/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#freebsd" itemprop="item"><span itemprop="name">Freebsd</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Basic Configuration of IPFW NAT Firewall with FreeBSD Server</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/pscustomobject.jpg" alt="UnixBSDShell's Blog" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">UnixBSDShell's Blog</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>unixwinbsd.site is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, unixwinbsd.site also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&amp;A forum for users to ask questions and get help from other members.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Moscow, Russia</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">DevOps Notes</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/iwan-setiawan-943659164/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:iwanse1212@yandex.com">
            <meta itemprop="email" content="iwanse1212@yandex.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Basic Configuration of IPFW NAT Firewall with FreeBSD Server">
    <meta itemprop="description" content="IPFIREWALL (IPFW) is a FreeBSD-sponsored firewall software application written and maintained by volunteer FreeBSD staff members. IPFW uses legacy stateless rules and legacy rule coding techniques to achieve what is called Simple Stateful logic">
    <meta itemprop="datePublished" content="2025-07-13T04:52:21+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Basic Configuration of IPFW NAT Firewall with FreeBSD Server
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          13 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#1-system-requirements">1. System Requirements</a></li>
  <li><a href="#2-kernel-configuration">2. Kernel Configuration</a></li>
  <li><a href="#3-configure-the-ip-address">3. Configure the IP Address</a></li>
  <li><a href="#4-configure-the-ipfw-firewall">4. Configure the IPFW Firewall</a></li>
</ul>

            </nav>
          </aside>
        
        <p>Firewalls allow for filtering of traffic entering and leaving a system. Firewalls use one or more sets of “rules” to evaluate network packets as they enter or exit a network connection and allow or disallow the traffic. Firewall rules examine one or more packet attributes, including protocol type, source/destination host addresses, and source/destination ports.</p>

<p>IPFIREWALL (IPFW) is a FreeBSD-sponsored firewall software application written and maintained by volunteer FreeBSD staff members. IPFW uses legacy stateless rules and legacy rule coding techniques to achieve what is called Simple Stateful logic.</p>

<p>IPFW’s stateless rule syntax is empowered with technically advanced selection capabilities that far exceed the knowledge level of the average firewall installer. IPFW is intended for professional users or advanced computer hobbyists with advanced packet selection requirements. A high-level, detailed understanding of how different protocols use and construct their unique packet header information is required before the power of IPFW rules can be unleashed. Providing that level of explanation is beyond the scope of this section of the handbook.</p>

<p>IPFW consists of seven components, the primary components being the kernel firewall filter rule processor and integrated packet counting facility, the logging facility, the NAT redirect rule trigger facility, and the advanced special-purpose facility, the dummynet traffic shaping facility, the forward ‘fwd rule’ facility, the bridge facility, and the ipstealth facility.</p>

<p>In this article, we will discuss NAT configuration using the IPFW Firewall. Before we delve further, let’s briefly explain NAT. Network Address Translation (NAT) is the process of mapping one Internet Protocol (IP) address to another by modifying the IP packet header as it passes through a router. This helps improve security and reduce the number of used IP addresses.</p>

<p>Why is NAT essential for internet access? As we know, accessing the internet requires a public IP address; computers with private IP addresses cannot access the internet. So, why can our home computers access the internet, but not computers with private IP addresses? NAT is the answer. With NAT, home computers or computers with private IP addresses can access the internet.</p>

<p><br /></p>

<p><img src="https://gitlab.com/unixbsdshell/unixbsdshell.gitlab.io/-/raw/main/images/10ipfw_firewall_configuration_on_freebsd.jpg" alt="ipfw firewall configuration on freebsd" /></p>

<p><br /></p>

<h2 id="1-system-requirements">1. System Requirements</h2>
<ul>
  <li>OS: FreeBSD 13.2 Stable</li>
  <li>Land Card IP nfe0: 192.168.5.2/24 (WAN Network)</li>
  <li>IP Land Card vr0: 192.168.7.1/24 (LAN Network)</li>
  <li>Default Router: 192.168.5.1</li>
  <li>CPU: AMD Phenom(tm) II X4 955 Processor</li>
</ul>

<h2 id="2-kernel-configuration">2. Kernel Configuration</h2>
<p>The first step in configuring NAT on a FreeBSD computer is to enable the kernel required for the IPFW Firewall. Add the script below to the <code class="language-plaintext highlighter-rouge">GENERIC</code> file.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /usr/src/sys/amd64/conf/GENERIC
<span class="go">options         IPFIREWALL
options         ROUTETABLES=7
options         DUMMYNET
options         HZ="1000"
</span><span class="gp">options         IPFIREWALL_VERBOSE  #</span><span class="w"> </span>enables logging <span class="k">for </span>rules with log keyword to syslogd<span class="o">(</span>8<span class="o">)</span>
<span class="gp">options         IPFIREWALL_VERBOSE_LIMIT=17  #</span><span class="w"> </span>limits number of logged packets per-entry
<span class="gp">options         IPFIREWALL_DEFAULT_TO_ACCEPT #</span><span class="w"> </span>sets default policy to pass what is not explicitly denied
<span class="gp">options         IPFIREWALL_NAT  #</span><span class="w"> </span>enables basic <span class="k">in</span><span class="nt">-kernel</span> NAT support
<span class="gp">options         LIBALIAS  #</span><span class="w"> </span>enables full <span class="k">in</span><span class="nt">-kernel</span> NAT support
<span class="gp">options         IPFIREWALL_NAT64  #</span><span class="w"> </span>enables <span class="k">in</span><span class="nt">-kernel</span> NAT64 support
<span class="gp">options         IPFIREWALL_NPTV6  #</span><span class="w"> </span>enables <span class="k">in</span><span class="nt">-kernel</span> IPv6 NPT support
<span class="gp">options         IPFIREWALL_PMOD  #</span><span class="w"> </span>enables protocols modification module support
<span class="gp">options         IPDIVERT  #</span><span class="w"> </span>enables NAT through natd<span class="o">(</span>8<span class="o">)</span>
<span class="go">options         IPSTEALTH
options         DEVICE_POLLING
options         MROUTING
device          coretemp
</span></code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">"options"</code> option in the above script enables the kernel required by the IPFW Firewall. You can place this script at the end of the GENERIC file. For a complete discussion of FreeBSD kernel configuration, you can read our previous article. Then, proceed to build and install the kernel. Type the following script.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span><span class="nb">cd</span> /usr/src
<span class="gp">root@ns1:/usr/src #</span><span class="w"> </span>make buildkernel <span class="o">&amp;&amp;</span> make installkernel <span class="o">&amp;&amp;</span> reboot
</code></pre></div></div>

<h2 id="3-configure-the-ip-address">3. Configure the IP Address</h2>
<p>After the computer has finished rebooting and restarted, continue configuring the IP address in the <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> file. Since we’re using two Land Cards in this tutorial, each Land Card must have a designated IP address. Type the following script into the <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> file.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@ns1:~ #</span><span class="w"> </span>ee /etc/rc.conf
<span class="go">ifconfig_nfe0="inet 192.168.5.2 netmask 255.255.255.0"
ifconfig_vr0="inet 192.168.7.1 netmask 255.255.255.0"
defaultrouter="192.168.5.1"
gateway_enable="YES"

firewall_enable="YES"
firewall_type="open"
</span><span class="gp">#</span><span class="nv">firewall_script</span><span class="o">=</span><span class="s2">"/etc/ipfw.rules"</span>
<span class="gp">#</span><span class="nv">firewall_script</span><span class="o">=</span><span class="s2">"/etc/ipfw2.rules"</span>
<span class="gp">#</span><span class="nv">firewall_script</span><span class="o">=</span><span class="s2">"/etc/ipfw3.rules"</span>
<span class="gp">#</span><span class="nv">firewall_script</span><span class="o">=</span><span class="s2">"/etc/ipfw4.rules"</span>
<span class="go">firewall_script="/etc/ipfw5.rules"
firewall_logging="YES"
firewall_logif="YES"

natd_enable="YES"
</span><span class="gp">natd_interface="nfe0"  #</span>Land Card WAN My Indihome
<span class="go">natd_flags="-dynamic -m"
</span></code></pre></div></div>
<p>In the script, the IP Address nfe0 is taken from the FiberHome My Indihome router <code class="language-plaintext highlighter-rouge">192.168.5.2</code> and the IP Address vr0 for the Local/Private network is <code class="language-plaintext highlighter-rouge">192.168.7.1</code>. For the default router, we use the gateway from the Fiber Home My Indihome modem, which is <code class="language-plaintext highlighter-rouge">192.168.5.1</code>. natd_enable to enable NAT on the router and gateway_enable to enable the gateway on the FreeBSD machine we are setting. Usually for the local/private network gateway on Land Card VR0, the gateway IP is the IP originating from Land Card <code class="language-plaintext highlighter-rouge">VR0</code>, which is <code class="language-plaintext highlighter-rouge">192.168.7.1</code>.</p>

<h2 id="4-configure-the-ipfw-firewall">4. Configure the IPFW Firewall</h2>

<p>Once all the above configurations are complete, proceed to configuring the IPFW Firewall. Below are some examples of <code class="language-plaintext highlighter-rouge">/etc/ipfw.rules</code> files that you can use and apply to your FreeBSD router.</p>

<p><strong>Sample script 1 /etc/ipfw.rules</strong></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="go">wan="nfe0"
lan="vr0"
wan_int="192.168.5.2"
lan_int="192.168.7.1"
ipfw="/sbin/ipfw -q"

</span><span class="gp">#</span><span class="w"> </span>?????????? ??? ???????:
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> <span class="nt">-f</span> flush
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> <span class="nt">-f</span> pipe flush
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> <span class="nt">-f</span> queue flush
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> add allow ip from any to any via lo0
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> add deny ip from any to 127.0.0.0/8
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> add deny ip from 127.0.0.0/8 to any
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> add divert natd ip from any to any via nfe0
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> add allow ip from any to any
<span class="gp">$</span><span class="o">{</span>ipfw<span class="o">}</span> add deny log all from any to any
</code></pre></div></div>
<p><strong>Sample script 2 /etc/ipfw.rules</strong></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="go">cmd="ipfw -q add"
skip="skipto 500"
pif="nfe0"
ks="keep-state"
good_tcpo="22,25,37,43,53,80,443,110,119"

ipfw -q -f flush

</span><span class="gp">$</span>cmd 002 allow all from any to any via vr0  <span class="c"># exclude LAN traffic</span>
<span class="gp">$</span>cmd 003 allow all from any to any via lo0  <span class="c"># exclude loopback traffic</span>
<span class="go">
</span><span class="gp">$</span>cmd 100 divert natd ip from any to any <span class="k">in </span>via <span class="nv">$pif</span>
<span class="gp">$</span>cmd 101 check-state
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Authorized outbound packets
<span class="gp">$</span>cmd 120 <span class="nv">$skip</span> udp from any to 1.1.1.1 53 out via <span class="nv">$pif</span> <span class="nv">$ks</span>
<span class="gp">$</span>cmd 121 <span class="nv">$skip</span> udp from any to 1.1.1.1 53 out via <span class="nv">$pif</span> <span class="nv">$ks</span>
<span class="gp">$</span>cmd 125 <span class="nv">$skip</span> tcp from any to any <span class="nv">$good_tcpo</span> out via <span class="nv">$pif</span> setup <span class="nv">$ks</span>
<span class="gp">$</span>cmd 130 <span class="nv">$skip</span> icmp from any to any out via <span class="nv">$pif</span> <span class="nv">$ks</span>
<span class="gp">$</span>cmd 135 <span class="nv">$skip</span> udp from any to any 123 out via <span class="nv">$pif</span> <span class="nv">$ks</span>
<span class="go">

</span><span class="gp">#</span><span class="w"> </span>Deny all inbound traffic from non-routable reserved address spaces
<span class="gp">$</span>cmd 300 deny all from 192.168.0.0/16  to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#RFC 1918 private IP</span>
<span class="gp">$</span>cmd 301 deny all from 172.16.0.0/12   to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#RFC 1918 private IP</span>
<span class="gp">$</span>cmd 302 deny all from 10.0.0.0/8      to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#RFC 1918 private IP</span>
<span class="gp">$</span>cmd 303 deny all from 127.0.0.0/8     to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#loopback</span>
<span class="gp">$</span>cmd 304 deny all from 0.0.0.0/8       to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#loopback</span>
<span class="gp">$</span>cmd 305 deny all from 169.254.0.0/16  to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#DHCP auto-config</span>
<span class="gp">$</span>cmd 306 deny all from 192.0.2.0/24    to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#reserved for docs</span>
<span class="gp">$</span>cmd 307 deny all from 204.152.64.0/23 to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#Sun cluster</span>
<span class="gp">$</span>cmd 308 deny all from 224.0.0.0/3     to any <span class="k">in </span>via <span class="nv">$pif</span>  <span class="c">#Class D &amp; E multicast</span>
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Authorized inbound packets
<span class="gp">$</span>cmd 400 allow udp from 192.168.5.2 to any 68 <span class="k">in</span> <span class="nv">$ks</span>
<span class="gp">$</span>cmd 420 allow tcp from any to me 80 <span class="k">in </span>via <span class="nv">$pif</span> setup limit src-addr 1
<span class="go">

</span><span class="gp">$</span>cmd 450 deny log ip from any to any
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>This is skipto location <span class="k">for </span>outbound stateful rules
<span class="gp">$</span>cmd 500 divert natd ip from any to any out via <span class="nv">$pif</span>
<span class="gp">$</span>cmd 510 allow ip from any to any via vr0
</code></pre></div></div>
<p><strong>Sample script 3 /etc/ipfw.rules</strong></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="go">
fw="/sbin/ipfw -q"
</span><span class="gp">#</span><span class="nv">admin</span><span class="o">=</span><span class="s2">"192.168.12.2, 192.168.12.7"</span>
<span class="gp">#</span><span class="nv">user</span><span class="o">=</span><span class="s2">"192.168.12.3, 192.168.12.5"</span>
<span class="go">lan="192.168.7.1"

</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> flush
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 10 allow all from any to any via lo0
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 20 deny ip from 127.0.0.0/8 to any
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 30 deny ip from any to 127.0.0.0/8
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 40 deny ip from 192.168.12.0/24 to any <span class="k">in </span>recv le0
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 50 deny ip from any to any frag
<span class="go">
</span><span class="gp">#</span><span class="k">${</span><span class="nv">fw</span><span class="k">}</span> add 55 fwd 127.0.0.1, 3128 ip from <span class="k">${</span><span class="nv">admin</span><span class="k">}</span> to any 80,443 <span class="k">in </span>recv le1
<span class="gp">#</span><span class="k">${</span><span class="nv">fw</span><span class="k">}</span> add 56 fwd 127.0.0.1, 3128 all from <span class="k">${</span><span class="nv">user</span><span class="k">}</span> to any 80,443 <span class="k">in </span>recv le1
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 60 divert natd all from any to any via nfe0
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 65 allow tcp from any 3389 to any
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 66 allow tcp from any to any 3389
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 67 allow tcp from any 22 to any
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 68 allow tcp from any to any 22
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 70 allow tcp from any to any established
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 80 allow tcp from me to any setup
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 90 allow udp from me to any 53 via nfe0
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 100 allow udp from any 53 to me via nfe0
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 110 allow tcp from me to any 80 via nfe0
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 111 allow tcp from any 80 to me via nfe0
<span class="go">
</span><span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 112 allow tcp from me to any 443 via nfe0
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 113 allow tcp from any 443 to me via nfe0
<span class="go">
</span><span class="gp">#</span><span class="k">${</span><span class="nv">fw</span><span class="k">}</span> add 110 allow all from <span class="k">${</span><span class="nv">admin</span><span class="k">}</span> to any via vr0
<span class="gp">#</span><span class="k">${</span><span class="nv">fw</span><span class="k">}</span> add 111 allow all from <span class="k">${</span><span class="nv">user</span><span class="k">}</span> to me via vr0
<span class="gp">$</span><span class="o">{</span>fw<span class="o">}</span> add 114 allow all from me to any via vr0
<span class="gp">#</span><span class="k">${</span><span class="nv">fw</span><span class="k">}</span> add 115 deny log all from any to any via vr0
</code></pre></div></div>
<p><strong>Sample script 4 /etc/ipfw.rules</strong></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="c">## set your outside network connecting to internet</span>
<span class="gp">#</span><span class="c">##  (interface network and netmask and ip)</span>
<span class="go">oif="nfe0"
onet="192.168.5.0"
omask="255.255.255.0"
oip="192.168.5.2"
onet6="fe80::"
oprefixlen6="64"
oip6="fe80::202:b3ff:fe0a:c30e"

</span><span class="gp">#</span><span class="c">## set your inside network connecting to user clients</span>
<span class="gp">#</span><span class="c">##  (interface network and netmask and ip)</span>
<span class="go">iif="nfe0"
inet="192.168.7.0"
imask="255.255.255.0"
iip="192.168.7.1"
inet6="2001:2f8:22:802::"
iprefixlen6="64"
iip6="2001:2f8:22:802::1"

</span><span class="gp">#</span><span class="c">## set firewall command path</span>
<span class="go">fwcmd="/sbin/ipfw"

</span><span class="gp">#</span><span class="c">## reset firewall rules</span>
<span class="gp">$</span>fwcmd <span class="nt">-q</span> <span class="nt">-f</span> flush
<span class="go">
</span><span class="gp">#</span><span class="c">## divert packet to NATD </span>
<span class="gp">$</span>fwcmd add 1 divert natd ip4 from any to any via <span class="k">${</span><span class="nv">oif</span><span class="k">}</span>
<span class="go">
</span><span class="gp">#</span><span class="c">## Stop spoofing</span>
<span class="gp">$</span>fwcmd add deny all from <span class="k">${</span><span class="nv">inet</span><span class="k">}</span>:<span class="k">${</span><span class="nv">imask</span><span class="k">}</span> to any <span class="k">in </span>via <span class="k">${</span><span class="nv">oif</span><span class="k">}</span>
<span class="gp">$</span>fwcmd add deny all from <span class="k">${</span><span class="nv">onet</span><span class="k">}</span>:<span class="k">${</span><span class="nv">omask</span><span class="k">}</span> to any <span class="k">in </span>via <span class="k">${</span><span class="nv">iif</span><span class="k">}</span>
<span class="go">
</span><span class="gp">#</span><span class="c">## Allow from / to myself</span>
<span class="gp">$</span>fwcmd add pass all from me to any
<span class="gp">$</span>fwcmd add pass all from any to me
<span class="go">
</span><span class="gp">#</span><span class="c">## Allow DNS queries out in the world</span>
<span class="gp">#</span><span class="c">## (if DNS is on localhost, delete passDNS)</span>
<span class="gp">$</span>fwcmd add pass udp from any 53 to any
<span class="gp">$</span>fwcmd add pass udp from any to any 53
<span class="gp">$</span>fwcmd add pass tcp from any to any 53
<span class="gp">$</span>fwcmd add pass tcp from any 53 to any
<span class="go">
</span><span class="gp">#</span><span class="c">## Allow RA RS NS NA Redirect...</span>
<span class="gp">#</span><span class="nv">$fwcmd</span> add pass ipv6-icmp from any to any
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Allow IP fragments to pass through
<span class="gp">$</span>fwcmd add pass all from any to any frag
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>Allow RIPng
<span class="gp">#</span><span class="nv">$fwcmd</span> add pass udp from fe80::/10 521 to ff02::9 521
<span class="gp">#</span><span class="nv">$fwcmd</span> add pass udp from fe80::/10 521 to fe80::/10 521
<span class="go">
</span><span class="gp">#</span><span class="c">###########Taggged rules############################</span>
<span class="gp">#</span><span class="c"># Opengate add following rules after authentication (at Layer2 check)</span>
<span class="gp">#</span><span class="c"># (Need 'net.link.ether.ipfw=1' in /etc/sysctl.conf to enable L2 check)</span>
<span class="gp">#</span><span class="c">#   count tag 123 ip from any to any MAC any &lt;CliMac&gt; keep-state via ..</span>
<span class="gp">#</span><span class="c">#   count tag 123 ip from any to any MAC &lt;CliMac&gt; any keep-state via ..</span>
<span class="gp">#</span><span class="c"># 123 : Can be set as IpfwTagNumber of opengatesrv.conf</span>
<span class="gp">#</span><span class="c"># &lt;CliMac&gt; :MAC address of authenticated client</span>
<span class="go">
</span><span class="gp">#</span><span class="nv">$fwcmd</span> add 60000 allow ip from any to any tagged 123
<span class="go">
</span><span class="gp">#</span><span class="c">###############################################</span>
<span class="go">
</span><span class="gp">#</span><span class="c"># At L2 check, throw all packets to L3 check after tagged</span>
<span class="gp">#</span><span class="nv">$fwcmd</span> add 60010 pass ip from any to any MAC any any
<span class="go">
</span><span class="gp">#</span><span class="c">## Forwarding IPv4 http connection from unauth client </span>
<span class="gp">#</span><span class="nv">$fwcmd</span> add 60100 fwd localhost tcp from <span class="k">${</span><span class="nv">inet</span><span class="k">}</span>:<span class="k">${</span><span class="nv">imask</span><span class="k">}</span> to any 80
<span class="gp">#</span><span class="nv">$fwcmd</span> add 60100 fwd localhost tcp from <span class="k">${</span><span class="nv">inet</span><span class="k">}</span>:<span class="k">${</span><span class="nv">imask</span><span class="k">}</span> to any 443
<span class="go">
</span><span class="gp">#</span><span class="c">## Allow http reply for forwarded request </span>
<span class="gp">#</span><span class="c">## (it is sent out from localhost but has original source address)</span>
<span class="gp">$</span>fwcmd add 60110 pass tcp from any 80 to any out
<span class="gp">$</span>fwcmd add 60120 pass tcp from any 443 to any out
<span class="gp">$</span>fwcmd add 60120 pass tcp from any 22 to any out
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>TCP reset notice message <span class="k">for </span>IPv6 http connection
<span class="gp">#</span><span class="nv">$fwcmd</span> add 60130 reset tcp from any to any 80
<span class="gp">#</span><span class="nv">$fwcmd</span> add 60140 reset tcp from any to any 443
</code></pre></div></div>
<p><strong>Sample script 5 /etc/ipfw.rules</strong></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="o">!</span>/bin/sh
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>1. General settings
<span class="gp">#</span><span class="w"> </span>1.1 Interfaces
<span class="gp">#</span><span class="w"> </span>1.1.1 External interface
<span class="go">eif="nfe0"
eip="192.168.5.2"
</span><span class="gp">#</span><span class="w"> </span>1.1.2 Internal interface
<span class="go">iif="vr0"
iip="192.168.7.1"
</span><span class="gp">#</span><span class="w"> </span>1.2 Access lists
<span class="gp">#</span><span class="w"> </span>1.2.1 Local access ACL
<span class="go">laccess="192.168.7.0/24"
</span><span class="gp">#</span><span class="w"> </span>1.2.2 Remote access ACL
<span class="gp">#</span><span class="nv">raccess</span><span class="o">=</span><span class="s2">"xx.xx.xx.188/30,xx.xx.xx.xx/30"</span>
<span class="gp">#</span><span class="w"> </span>1.2.3 Local access to external Mail Servers ACL
<span class="gp">#</span><span class="nv">emaccess</span><span class="o">=</span><span class="s2">"192.168.0.77,192.168.0.140"</span>
<span class="gp">#</span><span class="w"> </span>1.2.4 Blocklists ACL
<span class="go">blocklst01="192.168.0.0/16,172.16.0.0/12,10.0.0.0/8,127.0.0.0/8,0.0.0.0/8,169.254.0.0/16,192.0.2.0/24,204.152.64.0/23,224.0.0.0/3"
blocklst02="81,113,137,138,139,445"

        fwcmd="/sbin/ipfw -q"
        fwcmd="/sbin/ipfw"
</span><span class="gp">        $</span><span class="o">{</span>fwcmd<span class="o">}</span> <span class="nt">-f</span> flush
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>2.2 No restrictions on Loopback Interface
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add allow ip from any to any via lo0
<span class="gp">#</span><span class="w"> </span>2.3 Rules based on traffic destanation
<span class="gp">#</span><span class="w"> </span>2.3.1 External interface :: OUT
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add skipto 10000 all from any to any out via <span class="k">${</span><span class="nv">eif</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>2.3.2 External interface :: IN
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add skipto 15000 all from any to any <span class="k">in </span>via <span class="k">${</span><span class="nv">eif</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>2.3.3 Internal interface :: OUT
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add skipto 20000 all from any to any out via <span class="k">${</span><span class="nv">iif</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>2.3.4 Internal interface :: IN
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add skipto 25000 all from any to any <span class="k">in </span>via <span class="k">${</span><span class="nv">iif</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>2.6.3 Destanation does not match
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add deny log ip from any to any
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>3. Local Rulesets
<span class="gp">#</span><span class="w"> </span>3.1 Ruleset based on 2.3.1
<span class="gp">#</span><span class="w"> </span>NAT :: Outgoing packets
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 10000 divert natd ip from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to any
<span class="gp">#</span><span class="w"> </span>Local Network/Local Host :: Internet  <span class="o">(</span>ALL<span class="o">)</span>
<span class="gp">#</span><span class="k">${</span><span class="nv">fwcmd</span><span class="k">}</span> add 10050 allow ip from me to <span class="k">${</span><span class="nv">raccess</span><span class="k">}</span>
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 10100 allow ip from me to any keep-state
<span class="gp">#</span><span class="w"> </span>Default rule
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 10200 deny ip from any to any
<span class="gp">#</span><span class="nt">---------------------------</span>
<span class="gp">#</span><span class="w"> </span>3.2 Ruleset based on 2.3.2
<span class="gp">#</span><span class="w"> </span>Block List :: Non routable networks 
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15000 deny ip from <span class="k">${</span><span class="nv">blocklst01</span><span class="k">}</span> to any
<span class="gp">#</span><span class="w"> </span>NAT :: Incoming packets
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15100 divert natd ip from any to me
<span class="gp">#</span><span class="w"> </span>Dynamic rules
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15200 check-state
<span class="gp">#</span><span class="k">${</span><span class="nv">fwcmd</span><span class="k">}</span> add 15250 allow ip from <span class="k">${</span><span class="nv">raccess</span><span class="k">}</span> to me
<span class="gp">#</span><span class="w"> </span>Internet :: Local Netwok/Localhost <span class="o">(</span>Framents, ACK W/O SYN, NetBIOS, Ident<span class="o">)</span>
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15300 deny all from any to any frag
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15400 deny tcp from any to any established
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15500 deny tcp from any to any <span class="k">${</span><span class="nv">blocklst02</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>Internet :: Localhost <span class="o">(</span>SMTP, Restricted ICMP<span class="o">)</span>
<span class="gp">#</span><span class="k">${</span><span class="nv">fwcmd</span><span class="k">}</span> add 15600 allow tcp from any to me 25 setup keep-state
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15700 allow icmp from any to me icmptypes 0,3,8,11
<span class="gp">#</span><span class="w"> </span>Internet :: Local Network <span class="o">(</span>Static rule<span class="o">)</span>
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15800 allow ip from any to <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>Default rule
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 15900 deny ip from any to any
<span class="gp">#</span><span class="nt">---------------------------</span>
<span class="gp">#</span><span class="w"> </span>3.3 Ruleset based on 2.3.3
<span class="gp">#</span><span class="w"> </span>ALL :: Local Network
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 20000 allow ip from any to <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>Default rule
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 20100 deny ip from any to any
<span class="gp">#</span><span class="nt">---------------------------</span>
<span class="gp">#</span><span class="w"> </span>3.4 Ruleset based on 2.3.4
<span class="gp">#</span><span class="w"> </span>Local Network :: Localhost <span class="o">(</span>FTP, SSH, SMTP, DNS, DHCP, POP3, IMAP, SQUID, ICMP<span class="o">)</span>
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25000 allow tcp from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to me 53,8952,22,5053,853,67,8953,80,443
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25100 allow udp from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to me 53,67,8952,5053,8953
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25200 allow icmp from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to me
<span class="gp">#</span><span class="w"> </span>Local Network :: Local Network
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25300 allow ip from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span>
<span class="gp">#</span><span class="w"> </span>Local Network :: Internet <span class="o">(</span>Restricted SMTP, FTP, SSH, POP3, IMAP, HTTPS, Jabber, ICMP<span class="o">)</span>
<span class="gp">#</span><span class="k">${</span><span class="nv">fwcmd</span><span class="k">}</span> add 25400 allow ip from <span class="k">${</span><span class="nv">emaccess</span><span class="k">}</span> to any 25 keep-state
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25500 allow ip from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to any 53,8952,22,5053,853,67,8953,80,443 keep-state
<span class="gp">#</span><span class="k">${</span><span class="nv">fwcmd</span><span class="k">}</span> add 25550 allow ip from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to any 53,67,8952,5053,8953 keep-state
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25600 allow icmp from <span class="k">${</span><span class="nv">laccess</span><span class="k">}</span> to any
<span class="gp">#</span><span class="w"> </span>Default rule
<span class="gp">$</span><span class="o">{</span>fwcmd<span class="o">}</span> add 25700 deny ip from any to any
</code></pre></div></div>

<p>Please select one of the five IPFW Firewall script examples above. Don’t worry, all scripts have been tested and validated, and all scripts run normally, and the FreeBSD 13.2 router engine is stable. The above scripts can also be used on previous FreeBSD versions, namely FreeBSD 12, 11, 10.9, and 8. If all the configurations above don’t miss any NAT and the gateway should be running normally, but it’s still not perfect, why?</p>

<p>You need to add the ISC-DHCP application so that each client can automatically obtain an IP address (dynamic) or static (static IP). It would be even more complete if your FreeBSD router also has BIND or Unbound installed as a DNS server. If you encounter any difficulties or problems configuring NAT, please send us an email.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#sysadmin" class="page__taxonomy-item" rel="tag">SysAdmin</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#freebsd" class="page__taxonomy-item" rel="tag">FreeBSD</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2025-07-13T04:52:21+03:00">July 13, 2025</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=iwanset96143401&text=Basic+Configuration+of+IPFW+NAT+Firewall+with+FreeBSD+Server%20https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Fconfiguration-basic-ipfw-nat-freebsd-server%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Fconfiguration-basic-ipfw-nat-freebsd-server%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Fconfiguration-basic-ipfw-nat-freebsd-server%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/openbsd/using-chown-command-freebsd/" class="pagination--pager" title="Guide to Using the Chown Command in FreeBSD
">Previous</a>
    
    
      <a href="/openbsd/install-npm-node-js-openbsd/" class="pagination--pager" title="Install NPM Node JS on OpenBSD
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/installation-java-development-kit-on-freebsd/" rel="permalink">Installing and Using the Java Development Kit on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Redmine is open source software or application that uses the Ruby On Rails Framework. Redmine is a project management or project tracking application which r...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/how-to-install-webmin-on-freebsd-machine/" rel="permalink">How to Install Webmin on a FreeBSD System
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Webmin is a web-based system administration tool for Unix-like servers, and a service with approximately 1,000,000 annual installations worldwide
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/configuration-radicale-caldav-cardavv-server-freebsd/" rel="permalink">How to Configure FreeBSD with Radicale CalDAV CardDAV Server
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Radicale is run with the help of the Apache or NGINX web server, so it can be operated either as a standalone package using its internal http/https server or...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/setup-mirror-site-convert-pkg-package-freebsd/" rel="permalink">Setting up a Mirror Site to convert PKG Packages on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">PKG packages on FreeBSD contain pre-compiled software packages – called packages. This is the easiest way to install additional software under TwinCAT/BSD or...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/catanesi/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn Profile</a></li>
        
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 UnixBSDShell Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://unixwinbsd.site/freebsd/configuration-basic-ipfw-nat-freebsd-server/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/freebsd/configuration-basic-ipfw-nat-freebsd-server"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://UnixBSDShell.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  







  </body>
</html>
