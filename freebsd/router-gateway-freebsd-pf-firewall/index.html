<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Creating an Internet Router Gateway With FreeBSD and PF Firewall - UnixBSDShell</title>
<meta name="description" content="Packet Filter (PF) is a firewall developed for OpenBSD and later ported to FreeBSD and NetBSD.">


  <meta name="author" content="UnixBSDShell's Blog">
  
  <meta property="article:author" content="UnixBSDShell's Blog">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="UnixBSDShell">
<meta property="og:title" content="Creating an Internet Router Gateway With FreeBSD and PF Firewall">
<meta property="og:url" content="https://unixwinbsd.site/freebsd/router-gateway-freebsd-pf-firewall/">


  <meta property="og:description" content="Packet Filter (PF) is a firewall developed for OpenBSD and later ported to FreeBSD and NetBSD.">





  <meta name="twitter:site" content="@iwanset96143401">
  <meta name="twitter:title" content="Creating an Internet Router Gateway With FreeBSD and PF Firewall">
  <meta name="twitter:description" content="Packet Filter (PF) is a firewall developed for OpenBSD and later ported to FreeBSD and NetBSD.">
  <meta name="twitter:url" content="https://unixwinbsd.site/freebsd/router-gateway-freebsd-pf-firewall/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2025-05-19T10:25:10+03:00">





  

  


<link rel="canonical" href="https://unixwinbsd.site/freebsd/router-gateway-freebsd-pf-firewall/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "UnixBSDShell Blog",
      "url": "https://unixwinbsd.site/"
    
  }
</script>


  <meta name="google-site-verification" content="googledc9be5e5382da4fd" />


  <meta name="msvalidate.01" content="BCDF1444D895EBA62C6422C90DF8EA1C">



  <meta name="yandex-verification" content="69d778baa1dbd371">


<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="UnixBSDShell Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- <script data-ad-client="ca-pub-8799681346916578" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->

<!-- end custom head snippets -->


<meta name="google-site-verification" content="RT2u0cL3NCPK3ydcuewM50F8hvklo6JxBJGxu0zypiw" />
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js', 'ym');

    ym(95812963, 'init', {webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/95812963" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-TNPXBWRM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GT-TNPXBWRM');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWLWYNFRW0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RWLWYNFRW0');
</script>

<script>
gtag('set', 'user_data', {
"email": datainchi@gmail.com,
"phone_number": +6281289065249,
"address": {
"first_name": Iwan,
"last_name": Setiawan,
"street": Kp. Warung Bongkok RT. 002/01,
"city": Kabupaten Bekasi,
"region": Jawa Barat,
"postal_code": 17841,
"country": Indonesia
}
});
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N7TLZSRG');</script>
<!-- End Google Tag Manager -->



  </head>

  <body class="layout--single">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N7TLZSRG"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          UnixBSDShell
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Posts by Category</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Posts by Year</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://unixwinbsd.site/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#freebsd" itemprop="item"><span itemprop="name">Freebsd</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Creating an Internet Router Gateway With FreeBSD and PF Firewall</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/pscustomobject.jpg" alt="UnixBSDShell's Blog" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">UnixBSDShell's Blog</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>unixwinbsd.site is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, unixwinbsd.site also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&amp;A forum for users to ask questions and get help from other members.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Moscow, Russia</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">DevOps Notes</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/iwan-setiawan-943659164/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:iwanse1212@yandex.com">
            <meta itemprop="email" content="iwanse1212@yandex.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Creating an Internet Router Gateway With FreeBSD and PF Firewall">
    <meta itemprop="description" content="Packet Filter (PF) is a firewall developed for OpenBSD and later ported to FreeBSD and NetBSD.">
    <meta itemprop="datePublished" content="2025-05-19T10:25:10+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Creating an Internet Router Gateway With FreeBSD and PF Firewall
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#1-system-requirements">1. System Requirements</a></li>
  <li><a href="#2-kernel-configuration">2. Kernel Configuration</a></li>
  <li><a href="#3-create-boot-script-rcd">3. Create Boot Script rc.d</a></li>
  <li><a href="#4-pf-firewall-configuration">4. PF Firewall configuration</a></li>
</ul>

            </nav>
          </aside>
        
        <p>Packet Filter (PF) is a firewall developed for OpenBSD and later ported to FreeBSD and NetBSD. Compared to the same ipfw, it has a more understandable syntax for reading and writing firewall rules, has built-in NAT, traffic queuing and many more advantages of PF Firewall. This firewall was created by a UNIX hacker, from the beginning it has been embedded in the OpenBSD machine.</p>

<p>In the previous article we discussed Gateway Router with IPFW Firewall, on this occasion we will continue the discussion with the topic of building a Gateway Router with PF Firewall to access the internet. Actually the material is not much different from the article about building a Gateway Router with IPFW Firewall, we only add the PF Firewall kernel and configure the firewall rules a little.</p>

<h2 id="1-system-requirements">1. System Requirements</h2>

<ul>
  <li>OS: FreeBSD 13.2 Stable</li>
  <li>IP Land Card nfe0: 192.168.5.2/24 (Jaringan WAN / My Indihome)</li>
  <li>IP Land Card vr0: 192.168.7.1/24 (Jaringan Private/Local Network)</li>
  <li>Default Router: 192.168.5.1</li>
  <li>CPU: AMD Phenom(tm) II X4 955 Processor</li>
</ul>

<h2 id="2-kernel-configuration">2. Kernel Configuration</h2>

<p>While you don’t need to compile PF support into the FreeBSD kernel, you may want to do so to take advantage of one of PF’s advanced features not included in the loadable module, namely pfsync, which is a pseudo-device that exposes certain changes to the state table used by P.F. Can be paired with carp to create a failover firewall using PF Firewall.</p>

<p>In FreeBSD, ALTQ can be used with PF to provide Quality of Service (QOS). Once ALTQ is enabled, queues can be defined in rule sets that determine the processing priority of outgoing packets. Before enabling ALTQ, make sure the driver for the network card/Land Card installed on the FreeBSD system supports it. ALTQ is not available as a loadable kernel module. To activate the PF Firewall kernel on FreeBSD, add the following script to the GENERIC file in the <code class="language-plaintext highlighter-rouge">/usr/src/sys/amd64/conf</code> folder.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # ee /usr/src/sys/amd64/conf/GENERIC
options         ALTQ
options         ALTQ_CBQ
options         ALTQ_RED
options         ALTQ_RIO
options         ALTQ_HFSC
options         ALTQ_PRIQ
device		    pf
device		    pflog
device		    pfsync
</code></pre></div></div>

<p>What you need to pay attention to here is the type of FreeBSD machine or motherboard used. In this article, the motherboard and processor used are AMD, so the GENERIC file folder is in amd64 <code class="language-plaintext highlighter-rouge">/usr/src/sys/amd64</code>. After inserting the PF Firewall kernel module into the GENERIC build file and installing the GENERIC kernel.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # cd /usr/src
root@ns1:/usr/src # make build kernel &amp;&amp; make installkernel &amp;&amp; reboot
</code></pre></div></div>

<h2 id="3-create-boot-script-rcd">3. Create Boot Script rc.d</h2>

<p>After the build and install process for the PF Firewall kernel module is complete, create the rc.d script, so that the PF Firewall can be loaded automatically when the computer is rebooted. Type the following script in the <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # ee /etc/rc.conf
pf_enable="YES"                           # Enable PF (load module if re
pf_rules="/etc/pf1.conf"
#pf_rules="/etc/pf2.conf"
#pf_rules="/etc/pf3.conf"
#pf_rules="/etc/pf4.conf"
#pf_rules="/etc/pf5.conf"
pf_flags=""                               # additional flags for pfctl s
pflog_enable="YES"                        # start pflogd(8)
pflog_logfile="/var/log/pflog"            # where pflogd should store th
pflog_flags=""                            # additional flags for pflogd
pflogd_enable="YES"
pfsync_enable="YES"
</code></pre></div></div>

<p>After that, determine the IP Address of each interface/Lan Card.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # ee /etc/rc.conf
hostname="ns1"
#ifconfig_nfe0="DHCP"
ifconfig_nfe0="inet 192.168.5.2 netmask 255.255.255.0"
ifconfig_vr0="inet 192.168.7.1 netmask 255.255.255.0"
defaultrouter="192.168.5.1"
gateway_enable="YES"
natd_enable="YES"
natd_interface="nfe0"  #WAN
</code></pre></div></div>

<p>If the IP Address for each interface has been determined, create a file that will be filled with the PF Firewall rule script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # touch /etc/pf1.conf
root@ns1:~ # chmod -R +x /etc/pf1.conf
</code></pre></div></div>

<p>Add the following script to the <code class="language-plaintext highlighter-rouge">/boot/loader.conf</code> file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # ee /boot/loader.conf
net.inet.ip.fw.default_to_accept=1
</code></pre></div></div>

<p>After that, in the <code class="language-plaintext highlighter-rouge">/etc/sysctl.conf</code> file, add the following script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # ee /etc/sysctl.conf
net.inet.ip.forwarding=1
</code></pre></div></div>

<h2 id="4-pf-firewall-configuration">4. PF Firewall configuration</h2>

<p>The next step is to create rules for PF Firewall. Enter the following script in the <code class="language-plaintext highlighter-rouge">/etc/pf1.conf</code> file that we created above.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # ee /etc/pf1.conf
# /etc/pf.conf
### pf.conf
### macross
## internal and external interfaces
int_if = "vr0"
ext_if = "nfe0"
int_addr = "192.168.7.1"             # Internal IPv4 address (i.e., gateway for private network)
int_network = "192.168.7.0/24"       # Internal IPv4 networkqi

# Ports we want to allow access to from the outside world on our local system (ext_if)
tcp_services = "{ 22, 80,443,53,853 }"

# ping requests
icmp_types = "echoreq"

# Private networks, we are going to block incoming traffic from them
priv_nets = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"

### options
set block-policy drop
set loginterface $ext_if
set skip on lo0

### Scrub
scrub in all

# NAT traffic from internal network to external network through external interface
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)

### Filters ###
# Permit keep-state packets for UDP and TCP on external interfaces
pass out quick on $ext_if proto udp all keep state
pass out quick on $ext_if proto tcp all modulate state flags S/SA

# Permit any packets from internal network to this host
pass in quick on $int_if inet from $int_network to $int_addr

# Permit established sessions from internal network to any (incl. the Internet)
pass in quick on $int_if inet from $int_network to any keep state
# If you want to limit the number of sessions per NAT, nodes per NAT (simultaneously), and sessions per source IP
#pass in quick on $int_if inet from $int_network to any keep state (max 30000, source-track rule, max-src-nodes 100, max-src-states 500 )

# Permit and log all packets from clients in private network through NAT
pass in quick log on $int_if all

# Pass any other packets
pass in all
pass out all
</code></pre></div></div>

<p>When writing the script above, don’t make a mistake in determining the WAN and LAN interfaces. The WAN interface from Telkom My Indihome is <code class="language-plaintext highlighter-rouge">"nfe0"</code> and the interface for the local/private network is “vr0”. After that, restart the PF Firewall.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns1:~ # service pf restart
Disabling pf.
Enabling pf.
</code></pre></div></div>

<p>Below are several examples of PF Firewall rulesets that you can try and put into practice.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>### Example script 2: (pf_rules="/etc/pf2.conf)

# External interface
ext_if="nfe0"

# Internal interface
int_if="vr0"

# Follow RFC1918 and don't route to non-routable IPs
# http://www.iana.org/assignments/ipv4-address-space
# http://rfc.net/rfc1918.html
nonroute= "{ 0.0.0.0/8, 20.20.20.0/24, 127.0.0.0/8, 169.254.0.0/16,
        172.16.0.0/12, 192.0.2.0/24, 192.168.0.0/16, 224.0.0.0/3,
        255.255.255.255 }"

# Set allowed ICMP types
# Blocking ICMP entirely is bad practice and will break things,
# FreeBSD applies rate limiting by default to mitigate attacks.
icmp_types = "{ 0, 3, 4, 8, 11, 12 }"

####################################
#### Options and optimizations #####
####################################

# Set interface for logging (statistics)
set loginterface $ext_if

# Drop states as fast as possible without having excessively low timeouts
set optimization aggressive

# Block policy, either silently drop packets or tell sender that request is blocked
set block-policy return

# Don't bother to process (filter) following interfaces such as loopback:
set skip on lo0

# Scrub traffic
# Add special exception for game consoles such as PS3 and PS4 (NAT type 2 vs 3)
# scrub from CHANGEME to any no-df random-id fragment reassemble
scrub on $ext_if all no-df fragment reassemble

#######################
#### NAT &amp; Proxies ####
#######################

# Enable NAT and tell pf not to change ports if needed
# Add special exception for game consoles such as PS3 and PS4 (NAT type 2 vs 3)
# ie static-port mapping. Do NOT enable both rules.
# nat on $ext_if from $int_if:network to any -&gt; ($ext_if) static-port
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)

# Redirect ftp connections to ftp-proxy
rdr pass on $int_if inet proto tcp from $int_if:network to any port 21 -&gt; 127.0.0.1 port 8021

# Enable ftp-proxy (active connections)
# nat-anchor "ftp-proxy/*"
# rdr-anchor "ftp-proxy/*"

# Enable UPnP (requires miniupnpd, game consoles needs this)
# rdr-anchor "miniupnpd"

# Anchors needs to be set after nat/rdr-anchor
# Same as above regarding miniupnpd
# anchor "ftp-proxy/*"
# anchor "miniupnpd"

################################
#### Rules inbound (int_if) ####
################################

# Pass on everything incl multicast
pass in quick on $int_if from any to 239.0.0.0/8
pass in quick on $int_if inet all keep state

#################################
#### Rules outbound (int_if) ####
#################################

# Pass on everything incl multicast
pass out quick on $int_if from any to 239.0.0.0/8
pass out quick on $int_if inet all keep state

################################
#### Rules inbound (ext_if) ####
################################

# Drop packets from non-routable addresses immediately
block drop in quick on $ext_if from $nonroute to any

# Allow DHCP
pass in quick on $ext_if inet proto udp to ($ext_if) port { 67, 68 }

# Allow ICMP
pass in quick on $ext_if inet proto icmp all icmp-type $icmp_types

# Allow FTPs to connect to the FTP-proxy
# pass in quick on $ext_if inet proto tcp to ($ext_if) port ftp-data user proxy

# Block everything else
block in on $ext_if all

#################################
#### Rules outbound (ext_if) ####
#################################

# Drop packets to non-routable addresses immediately, allow everything else
block drop out quick on $ext_if from any to $nonroute
pass out on $ext_if all
</code></pre></div></div>
<p><br /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>###Example script 3: (pf_rules="/etc/pf3.conf")
ext_if = "nfe0"
int_if = "vr0"
localnet = "192.168.7.0/24"
set skip on lo0
set loginterface $ext_if
set block-policy return
scrub in all
nat on $ext_if from $localnet to any -&gt; ($ext_if)
block in on $ext_if all
pass on $int_if all
</code></pre></div></div>
<p><br /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>###Example script 4: (pf_rules="/etc/pf4.conf")
set limit table-entries 400000
set optimization normal
set limit states 198000
set limit src-nodes 198000

#System aliases
loopback = "{ lo0 }"
WANINDIHOME = "{ nfe0 }"
LANWIFI = "{ vr0 }"

table &lt;bogons&gt; persist file "/etc/bogons"

# Gateways
GWWANINDIHOMEGW = " route-to ( nfe0 192.168.5.1 ) "
GWLANWIFIGW = " route-to ( vr0 192.168.7.1 ) "

set block-policy return
set loginterface vr0
set keepcounters
set skip on pfsync0
set skip on lo0
set skip on $LANWIFI

scrub on $WANINDIHOME inet all    fragment reassemble
scrub on $LANWIFI inet all    fragment reassemble

#no nat proto carp
#no rdr proto carp
#nat-anchor "natearly/*"
#nat-anchor "natrules/*"

# Outbound NAT rules (manual)
nat on $WANINDIHOME inet from 127.0.0.0/8 to any port 500 -&gt; 192.168.5.2/32  static-port # Auto created rule for ISAKMP - localhost to WAN
nat on $WANINDIHOME inet from 127.0.0.0/8 to any -&gt; 192.168.5.2/32 port 1024:65535  # Auto created rule - localhost to WAN
nat on $WANINDIHOME inet from 192.168.7.0/24 to any port 500 -&gt; 192.168.5.2/32  static-port # Auto created rule for ISAKMP - localhost to LAN
nat on $WANINDIHOME inet from 192.168.7.0/24 to any -&gt; 192.168.5.2/32 port 1024:65535  # Auto created rule - localhost to LAN
nat on $WANINDIHOME inet from 192.168.5.0/24 to any port 500 -&gt; 192.168.5.2/32  static-port # Auto created rule for ISAKMP - localhost to LAN
nat on $WANINDIHOME inet from 192.168.5.0/24 to any -&gt; 192.168.5.2/32 port 1024:65535  # Auto created rule - localhost to LAN

#Redirect this traffic to our internal servers
rdr on $LANWIFI proto tcp from any to any port 53 -&gt; 192.168.7.1 port 53
rdr on $LANWIFI proto udp from any to any port 53 -&gt; 192.168.7.1 port 53
rdr on $LANWIFI proto udp from any to any port 80 -&gt; 192.168.7.1 port 8002

block in log quick from 169.254.0.0/16 to any ridentifier 1000000101 label "Block IPv4 link-local"
block in log quick from any to 169.254.0.0/16 ridentifier 1000000102 label "Block IPv4 link-local"
block in log inet all ridentifier 1000000103 label "Default deny rule IPv4"
block out log inet all ridentifier 1000000104 label "Default deny rule IPv4"
block log quick inet proto { tcp, udp } from any port = 0 to any ridentifier 1000000114 label "Block traffic from port 0"
block log quick inet proto { tcp, udp } from any to any port = 0 ridentifier 1000000115 label "Block traffic to port 0"
block in log quick on $WANINDIHOME from &lt;bogons&gt; to any ridentifier 11001 label "block bogon IPv4 networks from WANINDIHOME"
block in log quick on $WANINDIHOME from 10.0.0.0/8 to any ridentifier 12001 label "Block private networks from WANINDIHOME block 10/8"
block in log quick on $WANINDIHOME from 127.0.0.0/8 to any ridentifier 12002 label "Block private networks from WANINDIHOME block 127/8"
block in log quick on $WANINDIHOME from 172.16.0.0/12 to any ridentifier 12003 label "Block private networks from WANINDIHOME block 172.16/12"
block in log quick on $WANINDIHOME from 192.168.0.0/16 to any ridentifier 12004 label "Block private networks from WANINDIHOME block 192.168/16"
block in log quick on $WANINDIHOME from fc00::/7 to any ridentifier 12005 label "Block ULA networks from WANINDIHOME block fc00::/7"

pass in all
pass out all
antispoof log for $WANINDIHOME ridentifier 1000001570
antispoof log for $LANWIFI ridentifier 1000002620
pass quick on lo0 all

#allow access to DHCP server on LANWIFI
pass in  quick on $LANWIFI proto udp from any port = 68 to 255.255.255.255 port = 67 ridentifier 1000002641 label "allow access to DHCP server"
pass in  quick on $LANWIFI proto udp from any port = 68 to 192.168.7.1 port = 67 ridentifier 1000002642 label "allow access to DHCP server"
pass out  quick on $LANWIFI proto udp from 192.168.7.1 port = 67 to any port = 68 ridentifier 1000002643 label "allow access to DHCP server"

#First rule - allow all traffic from this server
pass in  on $loopback inet all ridentifier 1000002661 label "pass IPv4 loopback"
pass out  on $loopback inet all ridentifier 1000002662 label "pass IPv4 loopback"
pass in  on $loopback inet6 all ridentifier 1000002663 label "pass IPv6 loopback"
pass out  inet all keep state allow-opts ridentifier 1000002665 label "let out anything IPv4 from firewall host itself"
pass out  route-to ( nfe0 192.168.5.1 ) from 192.168.5.2 to !192.168.5.0/24 ridentifier 1000002761 keep state allow-opts label "let out anything from firewall host itself"
pass out  route-to ( vr0 192.168.7.1 ) from 192.168.7.1 to !192.168.7.0/24 ridentifier 1000002762 keep state allow-opts label "let out anything from firewall host itself"

# # # INCOMING TRAFFIC # # #
block in log all

# NAT Reflection rules
pass in  inet tagged PFREFLECT ridentifier 1000003081 keep state label "NAT REFLECT: Allow traffic to localhost"
pass  in  quick  on $WANINDIHOME reply-to ( nfe0 192.168.5.1 ) inet from any to any ridentifier 1676950281 keep state  label "USER_RULE"

pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet proto tcp  from 192.168.7.0/24 to any port 22 ridentifier 1676946710 flags S/SA keep state  label "SSH"
pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet proto tcp  from 192.168.7.0/24 to any port 53 ridentifier 1676946713 flags S/SA keep state  label "USER_RULE: Default allow LAN to any rule"
pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet proto udp  from 192.168.7.0/24 to any port 53 ridentifier 1676946729 keep state  label "USER_RULE: Default allow LAN to any rule"
pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet proto tcp  from 192.168.7.0/24 to any port 80 ridentifier 1676947088 flags S/SA keep state  label "USER_RULE: Default allow LAN to any rule"
pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet proto tcp  from 192.168.7.0/24 to any port 443 ridentifier 1676947099 flags S/SA keep state  label "USER_RULE: Default allow LAN to any rule"
pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet proto tcp  from 192.168.7.0/24 to any port 123 ridentifier 1676947120 flags S/SA keep state  label "USER_RULE: Default allow LAN to any rule"
pass  in  quick  on $LANWIFI reply-to ( vr0 192.168.7.1 ) inet from 192.168.7.0/24 to any ridentifier 0100000101 keep state  label "USER_RULE: Default allow LAN to any rule"
</code></pre></div></div>

<p>Please try the PF Firewall script example above, all scripts have been tested and tried on a stable FreeBSD 13.2 machine and the results are all the scripts above run smoothly.</p>

<p>If none of the above configurations are missed, then your PF Firewall is active and can run normally on the FreeBSD machine, but it is not perfect. You must install a DHCP server so that every client connected to your network gets an IP address automatically from the DHCP server. We recommend that you also install DNS such as BIND or Unbound.</p>

<p>If you encounter difficulties or obstacles in the NAT configuration, please send it via E-mail.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#sysadmin" class="page__taxonomy-item" rel="tag">SysAdmin</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#freebsd" class="page__taxonomy-item" rel="tag">FreeBSD</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2025-05-19T10:25:10+03:00">May 19, 2025</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=iwanset96143401&text=Creating+an+Internet+Router+Gateway+With+FreeBSD+and+PF+Firewall%20https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Frouter-gateway-freebsd-pf-firewall%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Frouter-gateway-freebsd-pf-firewall%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funixwinbsd.site%2Ffreebsd%2Frouter-gateway-freebsd-pf-firewall%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/freebsd/img-iso-flashdisk-bootable-dd/" class="pagination--pager" title="FreeBSD Write img iso To Flashdisk For Bootable With dd Command
">Previous</a>
    
    
      <a href="/freebsd/nginx-mod-ssl-freebsd-php-fpm/" class="pagination--pager" title="FreeBSD14 and NGINX WITH mod_SSL PHP-FPM
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/installation-java-development-kit-on-freebsd/" rel="permalink">Installing and Using the Java Development Kit on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Redmine is open source software or application that uses the Ruby On Rails Framework. Redmine is a project management or project tracking application which r...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/how-to-install-webmin-on-freebsd-machine/" rel="permalink">How to Install Webmin on a FreeBSD System
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Webmin is a web-based system administration tool for Unix-like servers, and a service with approximately 1,000,000 annual installations worldwide
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/configuration-radicale-caldav-cardavv-server-freebsd/" rel="permalink">How to Configure FreeBSD with Radicale CalDAV CardDAV Server
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Radicale is run with the help of the Apache or NGINX web server, so it can be operated either as a standalone package using its internal http/https server or...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/setup-mirror-site-convert-pkg-package-freebsd/" rel="permalink">Setting up a Mirror Site to convert PKG Packages on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">PKG packages on FreeBSD contain pre-compiled software packages – called packages. This is the easiest way to install additional software under TwinCAT/BSD or...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/catanesi/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn Profile</a></li>
        
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 UnixBSDShell Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://unixwinbsd.site/freebsd/router-gateway-freebsd-pf-firewall/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/freebsd/router-gateway-freebsd-pf-firewall"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://UnixBSDShell.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  







  </body>
</html>
