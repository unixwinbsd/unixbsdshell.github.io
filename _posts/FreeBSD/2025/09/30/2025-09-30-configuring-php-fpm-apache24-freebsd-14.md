---
title: Configuring PHP FPM and Apache24 on FreeBSD 14
date: "2025-09-30 15:12:02 +0100"
updated: "2025-09-30 15:12:02 +0100"
id: configuring-php-fpm-apache24-freebsd-14
lang: en
layout: single
author_profile: true
robots: index, follow
categories: freebsd
tags: WebServer
img: /img/oct-25/oct-25-64.jpg
header: 
  teaser: "/img/oct-25/oct-25-64.jpg"
toc: true
toc_label: "Table of Contents"
toc_icon: "heart"
toc_sticky: true
excerpt: PHP-FPM is a FastCGI process manager for PHP. The FastCGI protocol is based on the Common Gateway Interface (CGI), a protocol established between applications and web servers like Apache HTTP. This allows developers to write applications independently of the web server's behavior.
keywords: configuration, apache, apache24, php, fpm, freebsd, freebsd14
---
The Apache web server has evolved over the years to serve a variety of needs and tasks related to the HTTP/HTTPS protocol. Like other web servers, Apache must solve one crucial problem: how to service multiple processes to serve HTTP/HTTPS requests.

This task involves opening sockets, handling requests, keeping connections open for a specified period of time, handling new events that occur on those connections, and returning content generated by programs written in specific languages ​​(such as PHP, Perl, or Python). These tasks are executed and controlled by the Multi-Processing Module (MPM).

## A. PGP-FPM Apache

On the Apache Web server there are 3 MPM:

- **mpm_prefork:** A new process is created for each incoming connection reaching the server. Each process is isolated from the others, so there's no shared memory between them, even if they make identical calls at some point in their execution. This method is a safe way to run applications linked to libraries that don't support multithreading, typically older applications or libraries.
- **mpm_worker:** The parent process is responsible for starting a collection of child processes, some of which listen for new incoming connections, while others serve the requested content. Each process is multi-threaded (each thread serves one connection), allowing a single process to handle multiple requests simultaneously. This connection management method promotes better resource utilization while maintaining stability. This is due to the availability of a pool of available processes, which often have free threads ready to serve new connections immediately.
- **mpm_event:** While these processes rely on their workers, this MPM goes a step further by optimizing how the parent process schedules tasks for child processes and their associated threads. By default, connections remain open for 5 seconds and are closed if no new activity occurs. This is the default value of the keep-alive directive, which preserves the threads associated with them. Event MPM allows a process to manage threads so that some threads are free to process new incoming connections while others remain tied to live connections. This process allows for the redistribution of tasks assigned to threads, thus improving resource utilization and performance.

On FreeBSD systems, Apache24 uses the prefork MPM (Multi-Processing Module) by default. In some cases, these modules are excellent and offer the best compatibility, with MPM providing better performance on most systems. However, because PHP is not thread-safe, the standard mod_php method (PHP as an Apache module) is only compatible with prefork.

As a workaround, PHP-FPM (FastCGI Process Manager) is an alternative that provides a CGI daemon that can be used by any version of Apache and offers its own performance benefits over standard mod_php (PHP as an Apache module).

PHP-FPM is a FastCGI process manager for PHP. The FastCGI protocol is based on the Common Gateway Interface (CGI), a protocol established between applications and web servers like Apache HTTP. This allows developers to write applications independently of the web server's behavior. Programs run their own processes and transfer their output to the web server using this protocol. Each new connection the application needs to handle creates a new process.

By combining the Apache HTTP MPM module with the PHP FastCGI Process Manager (PHP-FPM), websites can load faster and handle more concurrent connections while using fewer resources.

## B. System Specifications
- OS: FreeBSD 13.2
- Web Server: Apache24
- Modul: PHP82 dan mod_php

Before you continue reading this article, it is recommended that you read the previous article which discusses the configuration and installation of apache24.

## C. Configuring Apache24 with PHP-FPM

The main PHP-FPM configuration file is located in the `/usr/local/etc/php-fpm.d/www.conf` folder, edit the file as in the example below.

```
root@ns1:~ # ee /usr/local/etc/php-fpm.d/www.conf
user = www
group = www
listen = 192.168.5.2:9000
listen.owner = www
listen.group = www
listen.mode = 0660
```

Remove the `"#"` sign in the script above, listen = 192.168.5.2 is the FreeBSD Server IP Address. After editing the main PHP-PFM configuration file, continue by creating the file `/usr/local/etc/apache24/Includes/php-fpm.conf` and type the script below in the file.

```
root@ns1:~ # ee /usr/local/etc/apache24/Includes/php-fpm.conf
<IfModule proxy_fcgi_module>
   <IfModule dir_module>
       DirectoryIndex index.php
   </IfModule>
   <FilesMatch "\.(php|phtml|inc)$">
       SetHandler "proxy:fcgi://192.168.5.2:9000"
   </FilesMatch>
</IfModule>
```

The script above is to activate the PHP-FPM module. When creating the script, it's important to note that the IP address in SetHandler must match the IP address in the `/usr/local/etc/php-fpm.d/www.conf` file.

The core PHP-FPM configuration is located in the `/usr/local/etc/apache24/httpd.conf` file. Edit some of the scripts in that file by removing the `"#"` symbol in front of the `/usr/local/etc/apache24/httpd.conf` script. Follow the example below to enable the PHP-FPM module on Apache24.

```
root@ns1:~ # ee /usr/local/etc/apache24/httpd.conf
#LoadModule mpm_event_module libexec/apache24/mod_mpm_event.so
LoadModule mpm_prefork_module libexec/apache24/mod_mpm_prefork.so
#LoadModule mpm_worker_module libexec/apache24/mod_mpm_worker.so
LoadModule authnz_fcgi_module libexec/apache24/mod_authnz_fcgi.so
LoadModule proxy_module libexec/apache24/mod_proxy.so
LoadModule proxy_http_module libexec/apache24/mod_proxy_http.so
LoadModule proxy_fcgi_module libexec/apache24/mod_proxy_fcgi.so
LoadModule proxy_scgi_module libexec/apache24/mod_proxy_scgi.so
```

Based on the explanation above in this article, there are three MPM modules; you can choose the one that best suits your needs. In this article, the module used is mpm_event. Next, edit the `/etc/make.conf` file and insert the following script into it.

```
root@ns1:~ # ee /etc/make.conf
WITH_MPM=event
```

DELETE the script below in the file `/usr/local/etc/apache24/httpd.conf`

```
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>
<FilesMatch "\.phps$">
    SetHandler application/x-httpd-php-source
</FilesMatch>
```

## D. Test PHP-FPM and Apache24

Once all the above configurations are complete, it's time to test. Create a test file called `php.info` and insert the following script into `/usr/local/www/apache24/data/info.php`.

```
root@ns1:~ # ee /usr/local/www/apache24/data/info.php

<?php phpinfo(); ?>
```

Grant ownership rights to the file as well as file permissions.

```
root@ns1:~ # chown -R www:www /usr/local/www/apache24/data/info.php
root@ns1:~ # chmod +x /usr/local/www/apache24/data/info.php
```

The next step is to enable the `PHP-FPM` module so it can run automatically. Edit the `/etc/rc.conf` file and insert the script below.

```
root@ns1:~ # ee /etc/rc.conf
php_fpm_enable="YES"
```

Before we do the testing, restart or reboot the apache24 web server and PHP-FPM.

```
root@ns1:~ # service apache24 restart
Performing sanity check on apache24 configuration:
Syntax OK
Stopping apache24.
Waiting for PIDS: 2437.
Performing sanity check on apache24 configuration:
Syntax OK
Starting apache24.
```
<br/>

```
root@ns1:~ # service php-fpm restart
Performing sanity check on php-fpm configuration:
[20-Aug-2023 13:20:07] NOTICE: configuration file /usr/local/etc/php-fpm.conf test is successful

Stopping php_fpm.
Waiting for PIDS: 2105.
Performing sanity check on php-fpm configuration:
[20-Aug-2023 13:20:07] NOTICE: configuration file /usr/local/etc/php-fpm.conf test is successful

Starting php_fpm.
```

The way to test PHP-FPM is by typing the FreeBSD Server IP Address, because in this article the FreeBSD server uses the IP 192.168.5.2, type the IP Address in a Web Browser such as Yandex or Google Chrome, then the results will appear as shown in the image below.

![php fast cgi di freebsd](/img/oct-25/oct-25-64.jpg)


## E. Apache24 PHP-FPM With Unix Sockets

The method above connects Apache to a PHP-FPM server using the TCP/IP protocol. In this section, we'll learn how to connect Apache to a PHP-FPM server using a UNIX socket.

Open the `/usr/local/etc/php-fpm.d/www.conf` file and change the `"listen=192.168.5.2:9000"` script to "listen=/tmp/php-fpm.sock".

```
listen = 192.168.5.2:9000

change with

listen = /tmp/php-fpm.sock
```

Then in the file `/usr/local/etc/apache24/Includes/php-fpm.conf`, type the script below.

```
<IfModule proxy_fcgi_module>
   <IfModule dir_module>
       DirectoryIndex index.php
   </IfModule>

   <FilesMatch "\.(php|phtml|inc)$">
SetHandler proxy:unix:/tmp/php-fpm.sock|fcgi://localhost/
   </FilesMatch>
</IfModule>
```

Restart the apache server and PHP-FPM server.

```
root@ns:~ # service apache24 restart
Performing sanity check on apache24 configuration:
Syntax OK
Stopping apache24.
Waiting for PIDS: 3258.
Performing sanity check on apache24 configuration:
Syntax OK
Starting apache24.
```

<br/>

```
root@ns:~ # service php-fpm restart
Performing sanity check on php-fpm configuration:
[21-Nov-2023 20:57:00] NOTICE: configuration file /usr/local/etc/php-fpm.conf test is successful

Stopping php_fpm.
Waiting for PIDS: 3211.
Performing sanity check on php-fpm configuration:
[21-Nov-2023 20:57:01] NOTICE: configuration file /usr/local/etc/php-fpm.conf test is successful

Starting php_fpm.
```

Note the 5th line, which says Server API FPM/FastCGI, which means the PHP-FPM module is `RUNNING` or running on the apache24 web server.

PHP-FPM is an efficient method for minimizing memory usage and improving website performance under heavy traffic. This method is significantly faster than traditional CGI-based methods in multi-user PHP environments. If your primary goal is to host web applications and achieve optimal performance and security, then PHP-FPM is the solution.