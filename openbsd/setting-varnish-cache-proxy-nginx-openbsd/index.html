<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>OpenBSD Varnish Cache Proxy With NGINX Backend - UnixBSDShell</title>
<meta name="description" content="Varnish is a very reliable reverse proxy server, its ability to work in front of your web server and serve content from your server, not someone else’s server or a remote web server">


  <meta name="author" content="UnixBSDShell's Blog">
  
  <meta property="article:author" content="UnixBSDShell's Blog">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="UnixBSDShell">
<meta property="og:title" content="OpenBSD Varnish Cache Proxy With NGINX Backend">
<meta property="og:url" content="https://unixwinbsd.site/openbsd/setting-varnish-cache-proxy-nginx-openbsd/">


  <meta property="og:description" content="Varnish is a very reliable reverse proxy server, its ability to work in front of your web server and serve content from your server, not someone else’s server or a remote web server">





  <meta name="twitter:site" content="@iwanset96143401">
  <meta name="twitter:title" content="OpenBSD Varnish Cache Proxy With NGINX Backend">
  <meta name="twitter:description" content="Varnish is a very reliable reverse proxy server, its ability to work in front of your web server and serve content from your server, not someone else’s server or a remote web server">
  <meta name="twitter:url" content="https://unixwinbsd.site/openbsd/setting-varnish-cache-proxy-nginx-openbsd/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2025-05-26T10:25:35+03:00">





  

  


<link rel="canonical" href="https://unixwinbsd.site/openbsd/setting-varnish-cache-proxy-nginx-openbsd/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "UnixBSDShell Blog",
      "url": "https://unixwinbsd.site/"
    
  }
</script>


  <meta name="google-site-verification" content="googledc9be5e5382da4fd" />


  <meta name="msvalidate.01" content="BCDF1444D895EBA62C6422C90DF8EA1C">



  <meta name="yandex-verification" content="69d778baa1dbd371">


<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="UnixBSDShell Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- <script data-ad-client="ca-pub-8799681346916578" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->

<!-- end custom head snippets -->


<meta name="google-site-verification" content="RT2u0cL3NCPK3ydcuewM50F8hvklo6JxBJGxu0zypiw" />
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js', 'ym');

    ym(95812963, 'init', {webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/95812963" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GT-TNPXBWRM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GT-TNPXBWRM');
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWLWYNFRW0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RWLWYNFRW0');
</script>

<script>
gtag('set', 'user_data', {
"email": datainchi@gmail.com,
"phone_number": +6281289065249,
"address": {
"first_name": Iwan,
"last_name": Setiawan,
"street": Kp. Warung Bongkok RT. 002/01,
"city": Kabupaten Bekasi,
"region": Jawa Barat,
"postal_code": 17841,
"country": Indonesia
}
});
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N7TLZSRG');</script>
<!-- End Google Tag Manager -->



  </head>

  <body class="layout--single">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N7TLZSRG"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          UnixBSDShell
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Posts by Category</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Posts by Year</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://unixwinbsd.site/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#openbsd" itemprop="item"><span itemprop="name">Openbsd</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">OpenBSD Varnish Cache Proxy With NGINX Backend</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/pscustomobject.jpg" alt="UnixBSDShell's Blog" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">UnixBSDShell's Blog</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>unixwinbsd.site is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, unixwinbsd.site also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&amp;A forum for users to ask questions and get help from other members.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Moscow, Russia</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">DevOps Notes</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/iwan-setiawan-943659164/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:iwanse1212@yandex.com">
            <meta itemprop="email" content="iwanse1212@yandex.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="OpenBSD Varnish Cache Proxy With NGINX Backend">
    <meta itemprop="description" content="Varnish is a very reliable reverse proxy server, its ability to work in front of your web server and serve content from your server, not someone else’s server or a remote web server">
    <meta itemprop="datePublished" content="2025-05-26T10:25:35+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">OpenBSD Varnish Cache Proxy With NGINX Backend
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#1-system-specifications">1. System specifications</a></li>
  <li><a href="#2-install-and-configure-nginx">2. Install and Configure NGINX</a></li>
  <li><a href="#3-install-varnish">3. Install Varnish</a></li>
  <li><a href="#4-configure-varnish-in-openbsd">4. Configure Varnish in OpenBSD</a></li>
  <li><a href="#5-test-varnish-with-web-browser">5. Test Varnish With Web Browser</a></li>
</ul>

            </nav>
          </aside>
        
        <p>Varnish is an HTTP proxy cache that can increase the speed of website access from your local network. Because, Varnish is one of the software that provides a very fast website hosting cache compared to standard web services. However, there is one major limitation, namely that it will not serve HTTPS content.</p>

<p>Varnish is a very reliable reverse proxy server, its ability to work in front of your web server and serve content from your server, not someone else’s server or a remote web server. The reverse proxy server is closely connected to the web server and can act on messages received from it. For example, a cached page can be refreshed with a purge command from the backend, something you can’t do with a cache that is closer to the client. This means that reverse proxy servers, in some cases, can store content longer than other types of caches.</p>

<p>In this tutorial, I will show you how to install Varnish on an OpenBSD 7.5 server with NGINX as the backend.</p>

<h2 id="1-system-specifications">1. System specifications</h2>
<p>Make sure your server computer has the following operating system and software installed.</p>
<ul>
  <li>OS: OpenBSD 7.5</li>
  <li>Hostname: ns3</li>
  <li>Domain: cursor.my.id</li>
  <li>IP address: 192.168.5.3</li>
  <li>Nginx version: nginx-1.24.0p0</li>
  <li>Nginx port: 8080</li>
  <li>Varnish version: varnish-7.4.2</li>
  <li>Varnish port: 80</li>
</ul>

<h2 id="2-install-and-configure-nginx">2. Install and Configure NGINX</h2>
<p>Since we will be using NGINX as the Varnish backend, installing NGINX is the first step you should take. Here are the commands you should type to install NGINX.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span>pkg_add nginx
</code></pre></div></div>
<p>After that, open the <code class="language-plaintext highlighter-rouge">/etc/nginx/nginx.conf</code> file and type the following script in the file.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user  www;
worker_processes  1;
worker_rlimit_nofile 1024;
events {
    worker_connections  800;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    index         index.html index.htm;
    keepalive_timeout  65;
    server_tokens off;

    server {
        listen       8080;
        listen       [::]:80;
        server_name  localhost;
        root         /var/www/htdocs;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root  /var/www/htdocs;
        }
    }
}
</code></pre></div></div>

<p>Then create an <code class="language-plaintext highlighter-rouge">index.html</code> file to check the NGINX server. The <code class="language-plaintext highlighter-rouge">index.html</code> file is located in the <code class="language-plaintext highlighter-rouge">/var/www/htdocs</code> directory. In the <code class="language-plaintext highlighter-rouge">index.html</code> file, type the following script.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Nginx port 8080<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>
<span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>Welcome to Nginx port HTTP<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>With Varnis Cache Proxy<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Then, run the command below, to create ownership and usage permissions for the file.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span><span class="nb">chown</span> <span class="nt">-R</span> www:www /var/www/htdocs/
<span class="gp">ns3#</span><span class="w"> </span><span class="nb">chmod</span> <span class="nt">-R</span> 775 /var/www/htdocs/
</code></pre></div></div>

<p>By default OpenBSD disables NGINX, to run NGINX, you must enable the NGINX server first. Run the following command to enable NGINX.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span>rcctl <span class="nb">enable </span>nginx
<span class="gp">ns3#</span><span class="w"> </span>rcctl restart nginx
</code></pre></div></div>

<h2 id="3-install-varnish">3. Install Varnish</h2>
<p>Varnish fetches content from an Apache or NGINX backend server, which is the web server where your content is created. In this article, we will use the NGINX web server as the Varnish backend. Installing Varnish is very easy, because OpenBSD has provided the Varnish package, you can directly install and activate Varnish with just a few commands. To install Varnish, you can run the following command.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span>pkg_add varnish
</code></pre></div></div>

<p>After that you activate Varnish.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span>rcctl <span class="nb">enable </span>varnishd
</code></pre></div></div>

<h2 id="4-configure-varnish-in-openbsd">4. Configure Varnish in OpenBSD</h2>
<p>By default, the basic Varnish configuration file can run normally, but the configuration file cannot run if you do not set the flag for the daemon. In OpenBSD, setting the flag is very important, because this flag will set all Varnish configurations. In this section we will explain how to set the flag for Varnish. The first thing you have to do is add a script to the <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> file, as in the following example.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">varnishd_flags=
</span></code></pre></div></div>

<p>After that, add another script in the <code class="language-plaintext highlighter-rouge">/etc/rc.conf.local</code> file, with the rcctl command as in the example below.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span>rcctl <span class="nb">set </span>varnishd flags <span class="s2">"-a http=192.168.5.3:80,HTTP -a proxy=192.168.5.3:6081,PROXY -j unix,user=_varnish,ccgroup=_varnish -f /etc/varnish/default.vcl -T localhost:9999 -p feature=+http2"</span>
</code></pre></div></div>

<p>To configure Varnish, you need to edit the <code class="language-plaintext highlighter-rouge">/etc/varnish/default.vcl</code> file. By default, the default.vcl file only enables the backend. Here is a complete example script for the <code class="language-plaintext highlighter-rouge">/etc/varnish/default.vcl</code> file.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vcl 4.1;

backend default {
    .host = "192.168.5.3";
    .port = "8080";
}

sub vcl_recv {
 	call vcl_builtin_recv;
 	return (hash);
 }
 
 sub vcl_builtin_recv {
 	call vcl_req_host;
 	call vcl_req_method;
 	call vcl_req_authorization;
 	call vcl_req_cookie;
 }
 
 sub vcl_req_host {
 	if (req.http.host ~ "[[:upper:]]") {
 		set req.http.host = req.http.host.lower();
 	}
 	if (!req.http.host <span class="err">&amp;&amp;</span>
 	    req.esi_level == 0 <span class="err">&amp;&amp;</span>
 	    req.proto == "HTTP/2") {
 		return (synth(400));
 	}
 }
 
 sub vcl_req_method {
 	if (req.method == "PRI") {
 		# This will never happen in properly formed traffic.
 		return (synth(405));
 	}
 	if (req.method != "GET" <span class="err">&amp;&amp;</span>
 	    req.method != "HEAD" <span class="err">&amp;&amp;</span>
 	    req.method != "PUT" <span class="err">&amp;&amp;</span>
 	    req.method != "POST" <span class="err">&amp;&amp;</span>
 	    req.method != "TRACE" <span class="err">&amp;&amp;</span>
 	    req.method != "OPTIONS" <span class="err">&amp;&amp;</span>
 	    req.method != "DELETE" <span class="err">&amp;&amp;</span>
 	    req.method != "PATCH") {
 		# Non-RFC2616 or CONNECT which is weird.
 		return (pipe);
 	}
 	if (req.method != "GET" <span class="err">&amp;&amp;</span> req.method != "HEAD") {
 		# We only deal with GET and HEAD by default.
 		return (pass);
 	}
 }
 
 sub vcl_req_authorization {
 	if (req.http.Authorization) {
 		# Not cacheable by default.
 		return (pass);
 	}
 }
 
 sub vcl_req_cookie {
 	if (req.http.Cookie) {
 		# Risky to cache by default.
 		return (pass);
 	}
 }
 
 sub vcl_pipe {
 	call vcl_builtin_pipe;
 	# unset bereq.http.connection;
 	return (pipe);
 }
 
 sub vcl_builtin_pipe {
 }
 
 sub vcl_pass {
 	call vcl_builtin_pass;
 	return (fetch);
 }
 
 sub vcl_builtin_pass {
 }
 
 sub vcl_hash {
 	call vcl_builtin_hash;
 	return (lookup);
 }
 
 sub vcl_builtin_hash {
 	hash_data(req.url);
 	if (req.http.host) {
 		hash_data(req.http.host);
 	} else {
 		hash_data(server.ip);
 	}
 }
 
 sub vcl_purge {
 	call vcl_builtin_purge;
 	return (synth(200, "Purged"));
 }
 
 sub vcl_builtin_purge {
 }
 
 sub vcl_hit {
 	call vcl_builtin_hit;
 	return (deliver);
 }
 
 sub vcl_builtin_hit {
 }
 
 sub vcl_miss {
 	call vcl_builtin_miss;
 	return (fetch);
 }
 
 sub vcl_builtin_miss {
 }
 
 sub vcl_deliver {
 	call vcl_builtin_deliver;
 	return (deliver);
 }
 
 sub vcl_builtin_deliver {
 }

sub vcl_synth {
 	call vcl_builtin_synth;
 	return (deliver);
 }
 
sub vcl_builtin_synth {
 	set resp.http.Content-Type = "text/html; charset=utf-8";
 	set resp.http.Retry-After = "5";
 	set resp.body = {"<span class="cp">&lt;!DOCTYPE html&gt;</span>
 <span class="nt">&lt;html&gt;</span>
   <span class="nt">&lt;head&gt;</span>
     <span class="nt">&lt;title&gt;</span>"} + resp.status + " " + resp.reason + {"<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;/head&gt;</span>
   <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;h1&gt;</span>Error "} + resp.status + " " + resp.reason + {"<span class="nt">&lt;/h1&gt;</span>
     <span class="nt">&lt;p&gt;</span>"} + resp.reason + {"<span class="nt">&lt;/p&gt;</span>
     <span class="nt">&lt;h3&gt;</span>Guru Meditation:<span class="nt">&lt;/h3&gt;</span>
     <span class="nt">&lt;p&gt;</span>XID: "} + req.xid + {"<span class="nt">&lt;/p&gt;</span>
     <span class="nt">&lt;hr&gt;</span>
     <span class="nt">&lt;p&gt;</span>Varnish cache server<span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
 "};
 }
 
 sub vcl_backend_fetch {
 	call vcl_builtin_backend_fetch;
 	return (fetch);
 }
 
 sub vcl_builtin_backend_fetch {
 	if (bereq.method == "GET") {
 		unset bereq.body;
 	}
 }
 
 sub vcl_backend_response {
 	call vcl_builtin_backend_response;
 	return (deliver);
 }
 
 sub vcl_builtin_backend_response {
 	if (bereq.uncacheable) {
 		return (deliver);
 	}
 	call vcl_beresp_stale;
 	call vcl_beresp_cookie;
 	call vcl_beresp_control;
 	call vcl_beresp_vary;
 }
 
 sub vcl_beresp_stale {
 	if (beresp.ttl <span class="nt">&lt;</span><span class="err">=</span> <span class="err">0</span><span class="na">s</span><span class="err">)</span> <span class="err">{</span>
 		<span class="na">call</span> <span class="na">vcl_beresp_hitmiss</span><span class="err">;</span>
 	<span class="err">}</span>
 <span class="err">}</span>
 
 <span class="na">sub</span> <span class="na">vcl_beresp_cookie</span> <span class="err">{</span>
 	<span class="na">if</span> <span class="err">(</span><span class="na">beresp.http.Set-Cookie</span><span class="err">)</span> <span class="err">{</span>
 		<span class="na">call</span> <span class="na">vcl_beresp_hitmiss</span><span class="err">;</span>
 	<span class="err">}</span>
 <span class="err">}</span>
 
 <span class="na">sub</span> <span class="na">vcl_beresp_control</span> <span class="err">{</span>
 	<span class="na">if</span> <span class="err">(</span><span class="na">beresp.http.Surrogate-control</span> <span class="err">~</span> <span class="err">"(?</span><span class="na">i</span><span class="err">)</span><span class="na">no-store</span><span class="err">"</span> <span class="err">||</span>
 	    <span class="err">(!</span><span class="na">beresp.http.Surrogate-Control</span> <span class="err">&amp;&amp;</span>
 	      <span class="na">beresp.http.Cache-Control</span> <span class="err">~</span> <span class="err">"(?</span><span class="na">i:no-cache</span><span class="err">|</span><span class="na">no-store</span><span class="err">|</span><span class="na">private</span><span class="err">)"))</span> <span class="err">{</span>
 		<span class="na">call</span> <span class="na">vcl_beresp_hitmiss</span><span class="err">;</span>
 	<span class="err">}</span>
 <span class="err">}</span>
 
 <span class="na">sub</span> <span class="na">vcl_beresp_vary</span> <span class="err">{</span>
 	<span class="na">if</span> <span class="na">(beresp.http.Vary =</span><span class="s">=</span> <span class="err">"</span><span class="na">*</span><span class="err">")</span> <span class="err">{</span>
 		<span class="na">call</span> <span class="na">vcl_beresp_hitmiss</span><span class="err">;</span>
 	<span class="err">}</span>
 <span class="err">}</span>
 
 <span class="na">sub</span> <span class="na">vcl_beresp_hitmiss</span> <span class="err">{</span>
 	<span class="na">set</span> <span class="na">beresp.ttl = </span><span class="s">120s;</span>
 	<span class="na">set</span> <span class="na">beresp.uncacheable = </span><span class="s">true;</span>
 	<span class="na">return</span> <span class="err">(</span><span class="na">deliver</span><span class="err">);</span>
 <span class="err">}</span>
 
<span class="na">sub</span> <span class="na">vcl_backend_error</span> <span class="err">{</span>
 	<span class="na">call</span> <span class="na">vcl_builtin_backend_error</span><span class="err">;</span>
 	<span class="na">return</span> <span class="err">(</span><span class="na">deliver</span><span class="err">);</span>
 <span class="err">}</span>
 
<span class="na">sub</span> <span class="na">vcl_builtin_backend_error</span> <span class="err">{</span>
 	<span class="na">set</span> <span class="na">beresp.http.Content-Type = </span><span class="s">"text/html; charset=utf-8"</span><span class="err">;</span>
 	<span class="na">set</span> <span class="na">beresp.http.Retry-After = </span><span class="s">"5"</span><span class="err">;</span>
 	<span class="na">set</span> <span class="na">beresp.body = </span><span class="s">{"&lt;!DOCTYPE</span> <span class="na">html</span><span class="nt">&gt;</span>
 <span class="nt">&lt;html&gt;</span>
   <span class="nt">&lt;head&gt;</span>
     <span class="nt">&lt;title&gt;</span>"} + beresp.status + " " + beresp.reason + {"<span class="nt">&lt;/title&gt;</span>
   <span class="nt">&lt;/head&gt;</span>
   <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;h1&gt;</span>Error "} + beresp.status + " " + beresp.reason + {"<span class="nt">&lt;/h1&gt;</span>
     <span class="nt">&lt;p&gt;</span>"} + beresp.reason + {"<span class="nt">&lt;/p&gt;</span>
     <span class="nt">&lt;h3&gt;</span>Guru Meditation:<span class="nt">&lt;/h3&gt;</span>
     <span class="nt">&lt;p&gt;</span>XID: "} + bereq.xid + {"<span class="nt">&lt;/p&gt;</span>
     <span class="nt">&lt;hr&gt;</span>
     <span class="nt">&lt;p&gt;</span>Varnish cache server<span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
 "};
 }

sub vcl_init {
 	return (ok);
 }
 
 sub vcl_fini {
 	return (ok);
 }
</code></pre></div></div>
<p>The final step is to run Varnish with the rcctl command.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ns3#</span><span class="w"> </span>rcctl restart varnishd
<span class="go">varnishd(ok)
varnishd(ok)
</span></code></pre></div></div>

<h2 id="5-test-varnish-with-web-browser">5. Test Varnish With Web Browser</h2>
<p>To be more sure whether varnis has worked as a proxy cache from Nginx, we have to do a test to prove it. You can do this test on the Google Chrome, Yandex or other web browsers.</p>

<p>In the Google Chrome address bar menu, type the varnis IP address, which is <code class="language-plaintext highlighter-rouge">http://192.168.5.3:8080/</code>. The results will be visible on your monitor screen as shown in the following image.</p>

<p><img src="https://gitflic.ru/project/unixbsdshell/ruby-static-page-jekyll-rb-openbsd/blob/raw?file=assets/images/NugetArticle/test%20varnish%20with%20google%20chrome.jpg&amp;commit=b166c24f5da03ee34f8bfb1d6bcddad406173ad5" alt="test varnish with google chrome" /></p>

<p>Congratulations, you have successfully installed Varnish on OpenBSD and now you have a simple setup to speed up your site. In this article, you learned the basics of Varnish, the process of installing and configuring Varnish, what Varnish is, and what the default settings are. We also briefly discussed VCL, Varnish’s configuration language.</p>

<p>VCL can be a bit tricky to understand, especially since it’s an unconventional way to do configuration, but it’s actually very easy to use once you read this article, and it’s also more flexible than configuration files. If you’d like to continue learning about Varnish, visit varnish-cache.org for more information.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#sysadmin" class="page__taxonomy-item" rel="tag">SysAdmin</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#openbsd" class="page__taxonomy-item" rel="tag">OpenBSD</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2025-05-26T10:25:35+03:00">May 26, 2025</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=iwanset96143401&text=OpenBSD+Varnish+Cache+Proxy+With+NGINX+Backend%20https%3A%2F%2Funixwinbsd.site%2Fopenbsd%2Fsetting-varnish-cache-proxy-nginx-openbsd%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funixwinbsd.site%2Fopenbsd%2Fsetting-varnish-cache-proxy-nginx-openbsd%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funixwinbsd.site%2Fopenbsd%2Fsetting-varnish-cache-proxy-nginx-openbsd%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/freebsd/setting-env-path-java-composer-go-freebsd/" class="pagination--pager" title="Setting ENV Paths in Freebsd for Java and Go Composer
">Previous</a>
    
    
      <a href="/openbsd/install-hugo-gohugo-freebsd-golang/" class="pagination--pager" title="How to Install Hugo GoHugo on FreeBSD GoLang
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/use-pfsense-pfBlockerNG-dnsbl-block-ads-malware/" rel="permalink">Use PFSense with pfBlockerNG DNSBL to Block Ads, Malware, Ransomware, and Web Tracking
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">By adding the pfBlockerNG package to your PFSense Router, you’ve blocked ads and also been able to block web tracking, ransomware, and malware. When you acti...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/installation-java-development-kit-on-freebsd/" rel="permalink">Installing and Using the Java Development Kit on FreeBSD
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Redmine is open source software or application that uses the Ruby On Rails Framework. Redmine is a project management or project tracking application which r...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/how-to-install-webmin-on-freebsd-machine/" rel="permalink">How to Install Webmin on a FreeBSD System
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Webmin is a web-based system administration tool for Unix-like servers, and a service with approximately 1,000,000 annual installations worldwide
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/freebsd/configuration-radicale-caldav-cardavv-server-freebsd/" rel="permalink">How to Configure FreeBSD with Radicale CalDAV CardDAV Server
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Radicale is run with the help of the Apache or NGINX web server, so it can be operated either as a standalone package using its internal http/https server or...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/catanesi/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn Profile</a></li>
        
      
        
          <li><a href="https://github.com/unixwinbsd/unixwinbsd.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 UnixBSDShell Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://unixwinbsd.site/openbsd/setting-varnish-cache-proxy-nginx-openbsd/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/openbsd/setting-varnish-cache-proxy-nginx-openbsd"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://UnixBSDShell.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  







  </body>
</html>
